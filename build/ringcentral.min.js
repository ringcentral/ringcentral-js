!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require(void 0),require(void 0),require(void 0)):"function"==typeof define&&define.amd?define(["pubnub","es6-promise","fetch-ponyfill"],t):"object"==typeof exports?exports.SDK=t(require(void 0),require(void 0),require(void 0)):(e.RingCentral=e.RingCentral||{},e.RingCentral.SDK=t(e[void 0],e[void 0],e[void 0]))}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="/build/",t(0)}([function(e,t,r){function n(e){this._externals=new h(e),this._cache=new i({externals:this._externals,prefix:e.cachePrefix}),this._client=new o(this._externals),this._platform=new u(s({},e,{externals:this._externals,client:this._client,cache:this._cache}))}var s=r(1),i=r(2),o=r(3),h=r(11),u=r(15),c=r(18),a=r(19),p=r(17);n.version=p.version,n.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},n.prototype.platform=function(){return this._platform},n.prototype.cache=function(){return this._cache},n.prototype.createSubscription=function(e){return new c(s({},e,{externals:this._externals,platform:this._platform}))},n.prototype.createCachedSubscription=function(e){return e="string"==typeof arguments[0]?{cacheKey:arguments[0].toString()}:e||{},new a(s({},e,{externals:this._externals,platform:this._platform,cache:this._cache}))},n.handleLoginRedirect=function(e){var t=window.location.hash?window.location.hash:window.location.search,r={};r[p.authResponseProperty]=t,window.opener.postMessage(r,e||window.location.origin)},e.exports=n},function(e,t){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
"use strict";function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function n(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;var n=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==n.join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(e){s[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(e){return!1}}var s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=n()?Object.assign:function(e,t){for(var n,h,u=r(e),c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var a in n)i.call(n,a)&&(u[a]=n[a]);if(s){h=s(n);for(var p=0;p<h.length;p++)o.call(n,h[p])&&(u[h[p]]=n[h[p]])}}return u}},function(e,t){function r(e){this._prefix=e.prefix||r.defaultPrefix,this._externals=e.externals}r.defaultPrefix="rc-",r.prototype.setItem=function(e,t){return this._externals.localStorage[this._prefixKey(e)]=JSON.stringify(t),this},r.prototype.removeItem=function(e){return delete this._externals.localStorage[this._prefixKey(e)],this},r.prototype.getItem=function(e){var t=this._externals.localStorage[this._prefixKey(e)];return t?JSON.parse(t):null},r.prototype.clean=function(){for(var e in this._externals.localStorage)this._externals.localStorage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._externals.localStorage[e];return this},r.prototype._prefixKey=function(e){return this._prefix+e},e.exports=r},function(e,t,r){function n(e,t){return e=e.toLowerCase(),Object.keys(t).reduce(function(t,r){return t?t:e==r.toLowerCase()?r:t},null)}function s(e){o.call(this),this._externals=e,this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}var i=r(4),o=r(6).EventEmitter,h=r(7),u=r(8);s._allowedMethods=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],s.prototype=Object.create(o.prototype),s.prototype.sendRequest=function(e){var t=new h({externals:this._externals,request:e});return new this._externals.Promise(function(r){this.emit(this.events.beforeRequest,t),r(this._loadResponse(e))}.bind(this)).then(function(e){return t.receiveResponse(e)}).then(function(){if(!t.ok())throw new Error("Response has unsuccessful status");return this.emit(this.events.requestSuccess,t),t}.bind(this)).catch(function(e){throw e.apiResponse||(e=this.makeError(e,t)),this.emit(this.events.requestError,e),e}.bind(this))},s.prototype._loadResponse=function(e){return this._externals.fetch.call(null,e)},s.prototype.makeError=function(e,t){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=t,e.originalMessage=e.message,e.message=t&&t.error(!0)||e.originalMessage),e},s.prototype.createRequest=function(e){if(e=e||{},e.headers=e.headers||{},!e.url)throw new Error("Url is not defined");if(e.method||(e.method="GET"),e.method=e.method.toUpperCase(),e.method&&s._allowedMethods.indexOf(e.method)<0)throw new Error("Method has wrong value: "+e.method);if(e.credentials=e.credentials||"include",e.mode=e.mode||"cors",e.query&&(e.url=e.url+(e.url.indexOf("?")>-1?"&":"?")+u.stringify(e.query)),n("Accept",e.headers)||(e.headers.Accept=h._jsonContentType),i(e.body)||!e.body){var t=n(h._contentType,e.headers);t||(t=h._contentType,e.headers[t]=h._jsonContentType);var r=e.headers[t];r.indexOf(h._jsonContentType)>-1?"GET"!==e.method&&"HEAD"!==e.method||!e.body?e.body=JSON.stringify(e.body):e.body=void 0:r.indexOf(h._urlencodedContentType)>-1&&(e.body=u.stringify(e.body))}var o=new this._externals.Request(e.url,e);return o.originalBody=e.body,o},e.exports=s},function(e,t,r){/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */
"use strict";function n(e){return s(e)===!0&&"[object Object]"===Object.prototype.toString.call(e)}var s=r(5);e.exports=function(e){var t,r;return n(e)!==!1&&(t=e.constructor,"function"==typeof t&&(r=t.prototype,n(r)!==!1&&r.hasOwnProperty("isPrototypeOf")!==!1))}},function(e,t){/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */
"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function s(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,s,h,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var a=new Error('Uncaught, unspecified "error" event. ('+t+")");throw a.context=t,a}if(r=this._events[e],o(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),r.apply(this,h)}else if(i(r))for(h=Array.prototype.slice.call(arguments,1),c=r.slice(),s=c.length,u=0;u<s;u++)c[u].apply(this,h);return!0},r.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),s||(s=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var s=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,s,o,h;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,s=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(h=o;h-- >0;)if(r[h]===t||r[h].listener&&r[h].listener===t){s=h;break}if(s<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){function r(e){this._externals=e.externals,this._request=e.request,this._response=e.response,this._text=e.responseText||"",this._json=null,this._multipart=[]}r._contentType="Content-Type",r._jsonContentType="application/json",r._multipartContentType="multipart/mixed",r._urlencodedContentType="application/x-www-form-urlencoded",r._headerSeparator=":",r._bodySeparator="\n\n",r._boundarySeparator="--",r._unauthorizedStatus=401,r.prototype.receiveResponse=function(e){return this._response=e,new this._externals.Promise(function(e){return e(this._isMultipart()||this._isJson()?this.response().text():"")}.bind(this)).then(function(e){return this._text=e,e}.bind(this))},r.prototype.response=function(){return this._response},r.prototype.request=function(){return this._request},r.prototype.ok=function(){return this._response&&this._response.ok},r.prototype.text=function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text},r.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},r.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(t=this.json().message),this.json().error_description&&(t=this.json().error_description),this.json().description&&(t=this.json().description)}catch(e){}return t},r.prototype.toMultipart=function(){return this._isMultipart()?this.multipart():[this]},r.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var e=this.text();if(!e)throw new Error("No response body");var t=this._getContentType().match(/boundary=([^;]+)/i)[1];if(!t)throw new Error("Cannot find boundary");var n=e.toString().split(r._boundarySeparator+t);if(""===n[0].trim()&&n.shift(),n[n.length-1].trim()==r._boundarySeparator&&n.pop(),n.length<1)throw new Error("No parts in body");var s=this._create(n.shift(),this._response.status,this._response.statusText).json();this._multipart=n.map(function(e,t){var r=s.response[t].status;return this._create(e,r)}.bind(this))}return this._multipart},r.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},r.prototype._getContentType=function(){return this._response.headers.get(r._contentType)||""},r.prototype._isMultipart=function(){return this._isContentType(r._multipartContentType)},r.prototype._isJson=function(){return this._isContentType(r._jsonContentType)},r.prototype._create=function(e,t,n){e=e||"",t=t||200,n=n||"OK",e=e.replace(/\r/g,"");var s=new this._externals.Headers,i=e.split(r._bodySeparator),o=i.length>1?i.shift():"";e=i.length>0?i.join(r._bodySeparator):null,(o||"").split("\n").forEach(function(e){var t=e.trim().split(r._headerSeparator),n=t.shift().trim(),i=t.join(r._headerSeparator).trim();n&&s.append(n,i)});var h=new this._externals.Response(e,{headers:s,status:t,statusText:n});return new r({externals:this._externals,request:null,response:h,responseText:e})},e.exports=r},function(e,t,r){"use strict";t.decode=t.parse=r(9),t.encode=t.stringify=r(10)},function(e,t){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,s){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(t);var h=1e3;s&&"number"==typeof s.maxKeys&&(h=s.maxKeys);var u=e.length;h>0&&u>h&&(u=h);for(var c=0;c<u;++c){var a,p,l,f,d=e[c].replace(o,"%20"),_=d.indexOf(n);_>=0?(a=d.substr(0,_),p=d.substr(_+1)):(a=d,p=""),l=decodeURIComponent(a),f=decodeURIComponent(p),r(i,l)?Array.isArray(i[l])?i[l].push(f):i[l]=[i[l],f]:i[l]=f}return i}},function(e,t){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(s){var i=encodeURIComponent(r(s))+n;return Array.isArray(e[s])?e[s].map(function(e){return i+encodeURIComponent(r(e))}).join(t):i+encodeURIComponent(r(e[s]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""}},function(e,t,r){(function(t){function n(e){e=e||{},this.PubNub=e.PubNub||h.PubNub||s,this.localStorage=e.localStorage||("undefined"!=typeof h.localStorage?h.localStorage:{}),this.Promise=e.Promise||h.Promise||i&&i.Promise;var t=o?o({Promise:this.Promise}):{};if(this.fetch=e.fetch||h.fetch||t.fetch,this.Request=e.Request||h.Request||t.Request,this.Response=e.Response||h.Response||t.Response,this.Headers=e.Headers||h.Headers||t.Headers,!(this.fetch&&this.Response&&this.Request&&this.Headers))throw new Error("Fetch API is missing");if(!this.Promise)throw new Error("Promise is missing");if(!this.localStorage)throw new Error("LocalStorage is missing");if(!this.PubNub)throw new Error("PubNub is missing")}var s=r(12),i=r(13),o=r(14),h="undefined"!=typeof window&&window||"undefined"!=typeof t&&t||function(){return this}();e.exports=n}).call(t,function(){return this}())},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){function n(e){s.call(this),this.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError"},e=e||{},this._server=e.server,this._appKey=e.appKey,this._appSecret=e.appSecret,this._redirectUri=e.redirectUri||"",this._refreshDelayMs=e.refreshDelayMs||100,this._clearCacheOnRefreshError="undefined"==typeof e.clearCacheOnRefreshError||e.clearCacheOnRefreshError,this._userAgent=(e.appName?e.appName+(e.appVersion?"/"+e.appVersion:"")+" ":"")+"RCJSSDK/"+u.version,this._externals=e.externals,this._cache=e.cache,this._client=e.client,this._refreshPromise=null,this._auth=new h({cache:this._cache,cacheId:n._cacheId,refreshHandicapMs:e.refreshHandicapMs})}var s=r(6).EventEmitter,i=r(8),o=r(1),h=r(16),u=r(17),c=r(7);n._urlPrefix="/restapi",n._apiVersion="v1.0",n._tokenEndpoint="/restapi/oauth/token",n._revokeEndpoint="/restapi/oauth/revoke",n._authorizeEndpoint="/restapi/oauth/authorize",n._cacheId="platform",n.prototype=Object.create(s.prototype),n.prototype.delay=function(e){return new this._externals.Promise(function(t,r){setTimeout(function(){t(null)},e)})},n.prototype.auth=function(){return this._auth},n.prototype.client=function(){return this._client},n.prototype.createUrl=function(e,t){e=e||"",t=t||{};var r="",s=e.indexOf("http://")!=-1||e.indexOf("https://")!=-1;return t.addServer&&!s&&(r+=this._server),e.indexOf(n._urlPrefix)!=-1||s||(r+=n._urlPrefix+"/"+n._apiVersion),r+=e,(t.addMethod||t.addToken)&&(r+=e.indexOf("?")>-1?"&":"?"),t.addMethod&&(r+="_method="+t.addMethod),t.addToken&&(r+=(t.addMethod?"&":"")+"access_token="+this._auth.accessToken()),r},n.prototype.loginUrl=function(e){return e=e||{},this.createUrl(n._authorizeEndpoint+"?"+i.stringify({response_type:e.implicit?"token":"code",redirect_uri:e.redirectUri||this._redirectUri,client_id:this._appKey,state:e.state||"",brand_id:e.brandId||"",display:e.display||"",prompt:e.prompt||""}),{addServer:!0})},n.prototype.parseLoginRedirect=function(e){function t(e,t){return e.split(t).reverse()[0]}var r=0===e.indexOf("#")&&t(e,"#")||0===e.indexOf("?")&&t(e,"?")||null;if(!r)throw new Error("Unable to parse response");var n=i.parse(r);if(!n)throw new Error("Unable to parse response");var s=n.error_description||n.error;if(s){var o=new Error(s);throw o.error=n.error,o}return n},n.prototype.loginWindow=function(e){return new this._externals.Promise(function(t,r){if("undefined"==typeof window)throw new Error("This method can be used only in browser");if(!e.url)throw new Error("Missing mandatory URL parameter");e=e||{},e.url=e.url||400,e.width=e.width||400,e.height=e.height||600,e.origin=e.origin||window.location.origin,e.property=e.property||u.authResponseProperty,e.target=e.target||"_blank";var n=void 0!==window.screenLeft?window.screenLeft:screen.left,s=void 0!==window.screenTop?window.screenTop:screen.top,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,h=i/2-e.width/2+n,c=o/2-e.height/2+s,a=window.open(e.url,"_blank","_blank"==e.target?"scrollbars=yes, status=yes, width="+e.width+", height="+e.height+", left="+h+", top="+c:"");if(!a)throw new Error("Could not open login window. Please allow popups for this site");a.focus&&a.focus();var p=window.addEventListener?"addEventListener":"attachEvent",l="addEventListener"==p?"removeEventListener":"detachEvent",f="addEventListener"==p?"message":"onmessage",d=function(n){try{if(n.origin!=e.origin)return;if(!n.data||!n.data[e.property])return;a.close(),window[l](f,d);var s=this.parseLoginRedirect(n.data[e.property]);if(!s.code&&!s.access_token)throw new Error("No authorization code or token");t(s)}catch(e){r(e)}}.bind(this);window[p](f,d,!1)}.bind(this))},n.prototype.loggedIn=function(){return this.ensureLoggedIn().then(function(){return!0}).catch(function(){return!1})},n.prototype.login=function(e){return new this._externals.Promise(function(t){e=e||{},this.emit(this.events.beforeLogin);var r={};return e.access_token?t(e):(e.code?e.code&&(r.grant_type="authorization_code",r.code=e.code,r.redirect_uri=e.redirectUri||this._redirectUri):(r.grant_type="password",r.username=e.username,r.password=e.password,r.extension=e.extension||""),e.endpointId&&(r.endpoint_id=e.endpointId),e.accessTokenTtl&&(r.accessTokenTtl=e.accessTokenTtl),e.refreshTokenTtl&&(r.refreshTokenTtl=e.refreshTokenTtl),void t(this._tokenRequest(n._tokenEndpoint,r)))}.bind(this)).then(function(e){var t=e.json?e:null,r=t&&t.json()||e;return this._auth.setData(r),this.emit(this.events.loginSuccess,t),t}.bind(this)).catch(function(e){throw this._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.loginError,e),e}.bind(this))},n.prototype._refresh=function(){return this.delay(this._refreshDelayMs).then(function(){if(this.emit(this.events.beforeRefresh),!this._auth.refreshToken())throw new Error("Refresh token is missing");if(!this._auth.refreshTokenValid())throw new Error("Refresh token has expired");return this._tokenRequest(n._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:this._auth.data().expires_in+1,refresh_token_ttl:this._auth.data().refresh_token_expires_in+1})}.bind(this)).then(function(e){var t=e.json();if(!t.access_token)throw this._client.makeError(new Error("Malformed OAuth response"),e);return this._auth.setData(t),this.emit(this.events.refreshSuccess,e),e}.bind(this)).catch(function(e){throw e=this._client.makeError(e),this._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,e),e}.bind(this))},n.prototype.refresh=function(){return this._refreshPromise||(this._refreshPromise=this._refresh().then(function(e){return this._refreshPromise=null,e}.bind(this)).catch(function(e){throw this._refreshPromise=null,e}.bind(this))),this._refreshPromise},n.prototype.logout=function(){return new this._externals.Promise(function(e){this.emit(this.events.beforeLogout),e(this._tokenRequest(n._revokeEndpoint,{token:this._auth.accessToken()}))}.bind(this)).then(function(e){return this._cache.clean(),this.emit(this.events.logoutSuccess,e),e}.bind(this)).catch(function(e){throw this.emit(this.events.logoutError,e),e}.bind(this))},n.prototype.inflateRequest=function(e,t){return t=t||{},t.skipAuthCheck?this._externals.Promise.resolve(e):this.ensureLoggedIn().then(function(){return e.headers.set("X-User-Agent",this._userAgent),e.headers.set("Client-Id",this._appKey),e.headers.set("Authorization",this._authHeader()),e}.bind(this))},n.prototype.sendRequest=function(e,t){return this.inflateRequest(e,t).then(function(e){return t=t||{},this._client.sendRequest(e)}.bind(this)).catch(function(r){if(!r.apiResponse||!r.apiResponse.response()||r.apiResponse.response().status!=c._unauthorizedStatus||t.retry)throw r;return this._auth.cancelAccessToken(),t.retry=!0,this.sendRequest(e,t)}.bind(this))},n.prototype.send=function(e){return e=e||{},e.url=this.createUrl(e.url,{addServer:!0}),this.sendRequest(this._client.createRequest(e),e)},n.prototype.get=function(e,t,r){return this.send(o({},{method:"GET",url:e,query:t},r))},n.prototype.post=function(e,t,r,n){return this.send(o({},{method:"POST",url:e,query:r,body:t},n))},n.prototype.put=function(e,t,r,n){return this.send(o({},{method:"PUT",url:e,query:r,body:t},n))},n.prototype.delete=function(e,t,r){return this.send(o({},{method:"DELETE",url:e,query:t},r))},n.prototype.ensureLoggedIn=function(){return this._isAccessTokenValid()?this._externals.Promise.resolve():this.refresh()},n.prototype._tokenRequest=function(e,t){return this.send({url:e,skipAuthCheck:!0,body:t,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":c._urlencodedContentType}})},n.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()},n.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},n.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},e.exports=n},function(e,t){function r(e){this._cache=e.cache,this._cacheId=e.cacheId,this._refreshHandicapMs=e.refreshHandicapMs||6e4}r.prototype.accessToken=function(){return this.data().access_token},r.prototype.refreshToken=function(){return this.data().refresh_token},r.prototype.tokenType=function(){return this.data().token_type},r.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},r.prototype.setData=function(e){e=e||{};var t=this.data();return Object.keys(e).forEach(function(r){t[r]=e[r]}),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,this._cache.setItem(this._cacheId,t),this},r.prototype.accessTokenValid=function(){var e=this.data();return e.expire_time-this._refreshHandicapMs>Date.now()},r.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},r.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},e.exports=r},function(e,t,r){var n="3.1.0";e.exports={version:n,authResponseProperty:"RCAuthorizationResponse"}},function(e,t,r){function n(e){s.call(this),e=e||{},this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},this._externals=e.externals,this._platform=e.platform,this._pollInterval=e.pollInterval||1e4,this._renewHandicapMs=e.renewHandicapMs||12e4,this._pubnub=null,this._pubnubLastChannel=null,this._timeout=null,this._subscription=null}var s=r(6).EventEmitter;n.prototype=Object.create(s.prototype),n.prototype.subscribed=function(){var e=this.subscription();return!!(e.id&&e.deliveryMode&&e.deliveryMode.subscriberKey&&e.deliveryMode.address)},n.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},n.prototype.expired=function(){return!this.subscribed()||(!this.subscribed()||Date.now()>this.subscription().expirationTime)},n.prototype.expirationTime=function(){return new Date(this.subscription().expirationTime||0).getTime()-this._renewHandicapMs},n.prototype.setSubscription=function(e){return e=e||{},this._clearTimeout(),this._setSubscription(e),this._subscribeAtPubnub(),this._setTimeout(),this},n.prototype.subscription=function(){return this._subscription||{}},n.prototype.register=function(){return this.alive()?this.renew():this.subscribe()},n.prototype.eventFilters=function(){return this.subscription().eventFilters||[]},n.prototype.addEventFilters=function(e){return this.setEventFilters(this.eventFilters().concat(e)),this},n.prototype.setEventFilters=function(e){var t=this.subscription();return t.eventFilters=e,this._setSubscription(t),this},n.prototype.subscribe=function(){return new this._externals.Promise(function(e){if(this._clearTimeout(),!this.eventFilters().length)throw new Error("Events are undefined");e(this._platform.post("/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}))}.bind(this)).then(function(e){var t=e.json();return this.setSubscription(t).emit(this.events.subscribeSuccess,e),e}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.reset().emit(this.events.subscribeError,e),e}.bind(this))},n.prototype.renew=function(){return new this._externals.Promise(function(e){if(this._clearTimeout(),!this.subscribed())throw new Error("No subscription");if(!this.eventFilters().length)throw new Error("Events are undefined");e(this._platform.put("/subscription/"+this.subscription().id,{eventFilters:this._getFullEventFilters()}))}.bind(this)).then(function(e){var t=e.json();return this.setSubscription(t).emit(this.events.renewSuccess,e),e}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.reset().emit(this.events.renewError,e),e}.bind(this))},n.prototype.remove=function(){return new this._externals.Promise(function(e){if(!this.subscribed())throw new Error("No subscription");e(this._platform.delete("/subscription/"+this.subscription().id))}.bind(this)).then(function(e){return this.reset().emit(this.events.removeSuccess,e),e}.bind(this)).catch(function(e){throw e=this._platform.client().makeError(e),this.emit(this.events.removeError,e),e}.bind(this))},n.prototype.resubscribe=function(){var e=this.eventFilters();return this.reset().setEventFilters(e).subscribe()},n.prototype.reset=function(){return this._clearTimeout(),this.subscribed()&&this._pubnub&&this._pubnub.unsubscribe({channel:this.subscription().deliveryMode.address}),this._setSubscription(null),this},n.prototype._setSubscription=function(e){this._subscription=e},n.prototype._getFullEventFilters=function(){return this.eventFilters().map(function(e){return this._platform.createUrl(e)}.bind(this))},n.prototype._setTimeout=function(){if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return this._timeout=setInterval(function(){this.alive()||(this.expired()?this.subscribe():this.renew())}.bind(this),this._pollInterval),this},n.prototype._clearTimeout=function(){return clearInterval(this._timeout),this},n.prototype._decrypt=function(e){if(!this.subscribed())throw new Error("No subscription");return this.subscription().deliveryMode.encryptionKey&&(e=this._pubnub.decrypt(e,this.subscription().deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})),e},n.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},n.prototype._subscribeAtPubnub=function(){if(!this.alive())throw new Error("Subscription is not alive");var e=this.subscription().deliveryMode;if(this._pubnub){if(this._pubnubLastChannel==e.address)return this;this._pubnubLastChannel&&this._pubnub.unsubscribe({channel:this._pubnubLastChannel}),this._pubnub=this._pubnub.init({ssl:!0,subscribe_key:e.subscriberKey})}else this._pubnub=new this._externals.PubNub({ssl:!0,subscribe_key:e.subscriberKey});return this._pubnubLastChannel=e.address,this._pubnub.subscribe({channel:e.address,message:this._notify.bind(this),connect:function(){}}),this},e.exports=n},function(e,t,r){function n(e){if(e=e||{},!e.cacheKey)throw new Error("Cached Subscription requires cacheKey parameter to be defined");this._cacheKey=e.cacheKey,s.call(this,e),this._cache=e.cache,this._subscription=void 0}var s=r(18);n.prototype=Object.create(s.prototype),n.prototype.subscription=function(){return this._cache.getItem(this._cacheKey)||{}},n.prototype._setSubscription=function(e){return this._cache.setItem(this._cacheKey,e)},n.prototype.restore=function(e){return this.eventFilters().length||this.setEventFilters(e),this},e.exports=n}])});
//# sourceMappingURL=ringcentral.min.js.map