!function(root){var core_pubnub_PubnubMock,core_Utils,core_Log,core_xhr_XhrResponse,core_xhr_XhrMock,core_Context,core_Observable,core_AjaxObserver,core_Ajax,core_Cache,core_Platform,core_Subscription,core_PageVisibility,core_Helper,core_Validator,core_List,helpers_Country,helpers_DeviceModel,helpers_Language,helpers_State,helpers_Location,helpers_ShippingMethod,helpers_Timezone,helpers_Account,helpers_BlockedNumber,helpers_Extension,helpers_Presence,helpers_Contact,helpers_Call,helpers_Conferencing,helpers_ContactGroup,helpers_Device,helpers_ForwardingNumber,helpers_Message,helpers_PhoneNumber,helpers_Ringout,helpers_Service,RCSDK;core_pubnub_PubnubMock=function(e){"use strict";function t(e){this.url=e,this.pubnub={ready:function(){}},this.onmessage=function(){},this.onclose=function(){},this.onerror=function(){},this.onopen=function(){},this.close=function(e,t){this.onclose({code:e,reason:t,wasClean:!0})},this.receiveMessage=function(e){this.onmessage({data:e})},this.onopen()}return e={$get:function(){return{ws:t}}}}({}),core_Utils=function(exports){"use strict";var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,rdigit=/\d/,class2type={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){class2type["[object "+e+"]"]=e.toLowerCase()});var Utils=exports={extend:function(){var e,t,r,n,o,i,s=arguments[0]||{},c=1,u=arguments.length,a=!1;for("boolean"==typeof s&&(a=s,s=arguments[c]||{},c++),"object"==typeof s||this.isFunction(s)||(s={});u>c;c++)if(null!=(e=arguments[c]))for(t in e)r=s[t],n=e[t],s!==n&&(a&&n&&(this.isPlainObject(n)||(o=this.isArray(n)))?(o?(o=!1,i=r&&this.isArray(r)?r:[]):i=r&&this.isPlainObject(r)?r:{},s[t]=this.extend(a,i,n)):void 0!==n&&(s[t]=n));return s},forEach:function(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=t(e[r],r);if(n===!1)break}},queryStringify:function(e){var t=[],r=this;return this.forEach(e,function(e,n){r.isArray(e)?e.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")},parseQueryString:function(e){var t={},r=this;return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var n=e.split("="),o=n[0].trim(),i=n[1].trim();o in t?(o in t&&!r.isArray(t[o])&&(t[o]=[t[o]]),t[o].push(i)):t[o]=i}}),t},isEmail:function(e,t){return t?/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?[ ,;]*)+$/i.test(e):/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)},isPhoneNumber:function(e){return/\+?1[0-9]{3}[0-9a-z]{7}/im.test(e.toString().split(/[^0-9a-z\+]/im).join(""))},argumentsToArray:function(e){return Array.prototype.slice.call(e||[],0)},isDate:function(e){return"date"===this.type(e)},isFunction:function(e){return"function"===this.type(e)},isArray:Array.isArray||function(e){return"array"===this.type(e)},isWindow:function(e){return e&&"object"==typeof e&&"setInterval"in e},isNaN:function(e){return null==e||!rdigit.test(e)||isNaN(e)},type:function(e){return null==e?String(e):class2type[toString.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==this.type(e)||e.nodeType||this.isWindow(e))return!1;if(e.constructor&&!hasOwn.call(e,"constructor")&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||hasOwn.call(e,t)},getProperty:function(obj,property){try{return eval("obj."+property)}catch(e){return void 0}},poll:function(e,t,r){this.stopPolling(r),t=t||1e3;var n=function(r){return r=r||t,t=r,setTimeout(function(){e(n,r)},r)};return n()},stopPolling:function(e){e&&clearTimeout(e)},parseString:function(e){return e?e.toString():""},parseNumber:function(e){return e?(e=parseFloat(e),isNaN(e)?0:e):0},$get:function(){return Utils}};return exports}({}),core_Log=function(e){"use strict";var t=core_Utils,r=e={logDebug:!1,logInfo:!1,logWarnings:!1,logErrors:!1,addTimestamps:!0,console:console||{log:function(){},warn:function(){},info:function(){},error:function(){}},disableAll:function(){this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1},enableAll:function(){this.logDebug=!0,this.logInfo=!0,this.logWarnings=!0,this.logErrors=!0},parseArguments:function(e){return e=t.argumentsToArray(e),this.addTimestamps&&e.unshift((new Date).toLocaleString(),"-"),e},debug:function(){this.logDebug&&this.console.log.apply(this.console,this.parseArguments(arguments))},info:function(){this.logInfo&&this.console.info.apply(this.console,this.parseArguments(arguments))},warn:function(){this.logWarnings&&this.console.warn.apply(this.console,this.parseArguments(arguments))},error:function(){this.logErrors&&this.console.error.apply(this.console,this.parseArguments(arguments))},$get:function(){return r}};return e}({}),core_xhr_XhrResponse=function(e){"use strict";function t(){this.responses=[]}return t.prototype.add=function(e){this.responses.push(e)},t.prototype.clear=function(){this.responses=[]},t.prototype.find=function(e){var t=null;return this.responses.forEach(function(r){e.url.indexOf(r.path)>-1&&(!r.test||r.test(e))&&(t=r)}),t},e={Class:t,$get:function(e){return e.createSingleton("XhrResponse",function(){return new t(e)})}}}({}),core_xhr_XhrMock=function(e){"use strict";function t(e){this.responses=core_xhr_XhrResponse.$get(e),this.async=!0,this.method="",this.url="",this.requestHeaders={},this.withCredentials=!1,this.data=null,this.readyState=0,this.responseHeaders={},this.status=0}var r=core_Log,n=core_Utils;return t.prototype.getResponseHeader=function(e){return this.responseHeaders[e]},t.prototype.setRequestHeader=function(e,t){this.requestHeaders[e]=t},t.prototype.open=function(e,t,r){this.method=e,this.url=t,this.async=r},t.prototype.send=function(e){var t=this.getRequestHeader("Content-Type");this.data=e,this.data&&"string"==typeof this.data&&("application/json"==t&&(this.data=JSON.parse(this.data)),"application/x-www-form-urlencoded"==t&&(this.data=n.parseQueryString(this.data))),r.debug("API REQUEST",this.method,this.url);var o=this.responses.find(this);if(!o)return void setTimeout(function(){this.onerror&&this.onerror(new Error("Unknown request: "+this.url))}.bind(this),1);this.setStatus(200),this.setResponseHeader("Content-Type","application/json");var i=o.response(this);"application/json"==this.getResponseHeader("Content-Type")&&(i=JSON.stringify(i)),this.responseText=i,setTimeout(function(){this.onload&&this.onload()}.bind(this),1)},t.prototype.abort=function(){r.debug("XhrMock.destroy(): Aborted")},t.prototype.getRequestHeader=function(e){return this.requestHeaders[e]},t.prototype.setResponseHeader=function(e,t){this.responseHeaders[e]=t},t.prototype.setStatus=function(e){return this.status=e,this},e={Class:t,$get:function(e){return new t(e)}}}({}),core_Context=function(e){"use strict";function t(e){this.singletons={},this.injections=e,this.stubPubnub=!1,this.stubAjax=!1}return t.prototype.createSingleton=function(e,t){return this.singletons[e]||(this.singletons[e]=t()),this.singletons[e]},t.prototype.usePubnubStub=function(e){return this.stubPubnub=!!e,this},t.prototype.useAjaxStub=function(e){return this.stubAjax=!!e,this},t.prototype.getCryptoJS=function(){return this.injections.CryptoJS},t.prototype.getXHR=function(){return this.injections.XHR},t.prototype.getPubnub=function(){return this.stubPubnub?core_pubnub_PubnubMock.$get(this):this.injections.PUBNUB},t.prototype.getLocalStorage=function(){return this.injections.localStorage},t.prototype.getPromise=function(){return this.injections.Promise},t.prototype.getXHR=function(){return this.stubAjax?core_xhr_XhrMock.$get(this):new this.injections.XHR},e={Class:t,$get:function(e){return new t(e)}}}({}),core_Observable=function(e){function t(){if(!(this instanceof t))throw new Error("Observable(): New operator was omitted");Object.defineProperty(this,"listeners",{value:{},enumerable:!1,writable:!0}),Object.defineProperty(this,"oneTimeEvents",{value:{},enumerable:!1,writable:!0}),Object.defineProperty(this,"oneTimeArguments",{value:{},enumerable:!1,writable:!0})}var r=core_Utils,n=core_Log;return Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.hasListeners=function(e){return e in this.listeners},t.prototype.registerOneTimeEvent=function(e){this.oneTimeEvents[e]=!1,this.oneTimeArguments[e]=[]},t.prototype.on=function(e,t){if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");var r=this;return e.forEach(function(e){r.hasListeners(e)||(r.listeners[e]=[]),r.listeners[e].push(t),r.isOneTimeEventFired(e)&&(n.debug("Observable.on(%s): One-time event has been fired already, executing callback",e),t.apply(r,r.getOneTimeEventArgumens(e)))}),this},t.prototype.emit=function(e){if(this.isOneTimeEventFired(e))return n.debug("Observable.emit(%s): One-time event has been fired already",e),null;var t=this,o=r.argumentsToArray(arguments).splice(1),i=null;return this.isOneTimeEvent(e)&&(this.setOneTimeEventFired(e),this.setOneTimeEventArgumens(e,o)),this.hasListeners(e)?(this.listeners[e].some(function(e){return i=e.apply(t,o),i===!1}),i):null},t.prototype.off=function(e,t){var r=this;if(t){if(!this.hasListeners(e))return this;this.listeners[e].forEach(function(n,o){n===t&&delete r.listeners[e][o]})}else delete this.listeners[e];return this},t.prototype.isOneTimeEvent=function(e){return e in this.oneTimeEvents},t.prototype.isOneTimeEventFired=function(e){return this.isOneTimeEvent(e)?this.oneTimeEvents[e]:!1},t.prototype.setOneTimeEventFired=function(e){this.oneTimeEvents[e]=!0},t.prototype.setOneTimeEventArgumens=function(e,t){this.oneTimeArguments[e]=t},t.prototype.getOneTimeEventArgumens=function(e){return this.oneTimeArguments[e]},t.prototype.offAll=function(){this.listeners={},this.oneTimeEvents={},this.oneTimeArguments={}},t.prototype.destroy=function(){return this.offAll(),n.debug("Observable.destroy(): Listeners were destroyed"),this},t.prototype.emitAndCallback=function(e,t,n){return t=r.argumentsToArray(t),e&&this.emit.apply(this,[e].concat(t)),n&&n.apply(this,t),this},e={Class:t,$get:function(e){return new t(e)}}}({}),core_AjaxObserver=function(e){"use strict";function t(){r.call(this)}var r=core_Observable.Class;return t.prototype=Object.create(r.prototype),t.prototype.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"},e={Class:t,$get:function(e){return e.createSingleton("AjaxObserver",function(){return new t})}}}({}),core_Ajax=function(e){"use strict";function t(e){r.call(this),this.data=null,this.error=null,this.response="",this.headers={},this.status=0,this.options={},this.context=e,this.observer=core_AjaxObserver.$get(e),this.xhr=null}var r=core_Observable.Class,n=core_Utils,o=core_Log,i=/^['"\{\[]/;return t.prototype=Object.create(r.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.getOptions=function(){return this.options},t.prototype.setOptions=function(e){return e&&(this.options=e),this},t.prototype.getContentType=function(){return this.headers["Content-Type"]||""},t.prototype.isMultipart=function(){return this.getContentType().indexOf("multipart/mixed")>-1},t.prototype.isUnauthorized=function(){return 401==this.status},t.prototype.isLoaded=function(){return!!this.status},t.prototype.checkOptions=function(){if(!this.options.url)throw new Error("Url is not defined");var e={Accept:"application/json","Content-Type":"application/json"};if(this.options.method=this.options.method?this.options.method.toUpperCase():"GET",this.options.async=void 0!==this.options.async?this.options.async:!0,this.options.get=this.options.get||null,this.options.headers=n.extend(e,this.options.headers),this.options.post=this.options.post?"string"!=typeof this.options.post&&"application/json"===this.options.headers["Content-Type"]?JSON.stringify(this.options.post):this.options.post:"",this.options.url=this.options.url+(this.options.get?(this.options.url.indexOf("?")>-1?"&":"?")+n.queryStringify(this.options.get):""),["GET","POST","PUT","DELETE","PATCH","OPTIONS"].indexOf(this.options.method)<0)throw new Error("Method has wrong value");return delete this.options.get,this},t.prototype.send=function(){return this.observer.emit(this.observer.events.beforeRequest,this),this.context.getPromise().resolve(this).then(this.checkOptions.bind(this)).then(this.request.bind(this)).then(function(e){if(e.parseResponse(),e.error)throw e.error;return e}.bind(this)).then(function(e){return this.observer.emit(this.observer.events.requestSuccess,e),e}.bind(this)).catch(function(e){throw e.ajax=this,this.observer.emit(this.observer.events.requestError,e),e}.bind(this))},t.prototype.getXHR=function(){return this.context.getXHR()},t.prototype.request=function(){return new(this.context.getPromise())(function(e,t){var r=this.options,o=this.getXHR();o.open(r.method,r.url,r.async),o.withCredentials=!0,o.onload=function(){this.response=o.responseText,this.headers={"Content-Type":o.getResponseHeader("Content-Type")},this.status=o.status,e(this)}.bind(this),o.onerror=function(){t(new Error("The request cannot be sent"))},n.forEach(r.headers,function(e,t){o.setRequestHeader(t,e)}),o.send("GET"===r.method?null:r.post),this.xhr=o}.bind(this))},t.prototype.checkStatus=function(e){return"2"==e.toString().substr(0,1)},t.prototype.splitHeadersAndContent=function(e){var t={content:e,headers:{}};if(e=e.trim(),i.test(e))return t;var r=e.split("\n\n",2);return t.content=r[1],t.headers=r[0].split("\n").reduce(function(e,t){var r=t.split(": ");return e[r[0]]=r[1],e},t.headers),t},t.prototype.parseResponse=function(){if(this.isMultipart())try{var e=(this.getContentType().split("boundary=")[1],this.response.split(/--Boundary_[\d]+_[\d]+_[\d]+/)),r=this.splitHeadersAndContent(e[1]),n=JSON.parse(r.content);this.data=[],n.response.forEach(function(r,n){var o=new t(this.context),i=this.splitHeadersAndContent(e[parseInt(n)+2]);o.status=r.status,o.response=i.content,o.headers=i.headers;try{o.parseResponse()}catch(s){}this.data.push(o)},this)}catch(i){o.error("Ajax.parseResponse(): Unable to parse batch response"),o.error(i.stack||i),this.error=i}else{var s=null,c=this.response&&"string"==typeof this.response;try{s=c?JSON.parse(this.response):this.response,this.checkStatus(this.status)||(this.error=new Error(s.message||s.error_description||s.description))}catch(i){o.error("Ajax.parseResponse(): Unable to parse data"),o.error(i.stack||i),o.error(this.response),this.error=i}this.data=s}return this},t.prototype.destroy=function(){return this.xhr&&this.xhr.abort(),r.prototype.destroy.call(this)},e={Class:t,$get:function(e){return new t(e)}}}({}),core_Cache=function(e){"use strict";function t(e){r.call(this),this.prefix="rc-",this.storage=e.getLocalStorage()}var r=core_Observable.Class;return t.prototype=Object.create(r.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.prefixKey=function(e){return this.prefix+e},t.prototype.setItem=function(e,t){return this.storage.setItem(this.prefixKey(e),JSON.stringify(t)),this},t.prototype.removeItem=function(e){return this.storage.removeItem(this.prefixKey(e)),this},t.prototype.getItem=function(e){var t=this.storage.getItem(this.prefixKey(e));return t?JSON.parse(t):null},t.prototype.clean=function(){for(var e in this.storage)this.storage.hasOwnProperty(e)&&0===e.indexOf(this.prefix)&&(this.storage.removeItem(e),delete this.storage[e]);return this},e={Class:t,$get:function(e){return e.createSingleton("Cache",function(){return new t(e)})}}}({}),core_Platform=function(e){"use strict";function t(e){n.call(this),this.server="",this.apiKey="",this.account="~",this.urlPrefix="/restapi",this.apiVersion="v1.0",this.accountPrefix="/account/",this.accessTokenTtl=600,this.refreshTokenTtl=36e3,this.refreshTokenTtlRemember=604800,this.refreshHandicapMs=6e4,this.clearCacheOnRefreshError=!0,this.refreshPromise=null,this.context=e}var r=core_Utils,n=core_Observable.Class,o=core_Log,i="forced";return t.prototype=Object.create(n.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.cacheId="platform",t.prototype.pollInterval=250,t.prototype.releaseTimeout=5e3,t.prototype.events={accessViolation:"accessViolation",logoutSuccess:"logoutSuccess",logoutError:"logoutError",authorizeSuccess:"authorizeSuccess",authorizeError:"authorizeError",refreshSuccess:"refreshSuccess",refreshError:"refreshError"},t.prototype.getStorage=function(){return core_Cache.$get(this.context)},t.prototype.getAjax=function(){return core_Ajax.$get(this.context)},t.prototype.clearStorage=function(){return this.getStorage().clean(),this},t.prototype.remember=function(e){var t=this.cacheId+"-remember";return void 0!=e?(this.getStorage().setItem(t,e),this):this.getStorage().getItem(t)||!1},t.prototype.authorize=function(e){return e=e||{},e.remember=e.remember||!1,this.authCall({url:"/restapi/oauth/token",post:{grant_type:"password",username:e.username,extension:e.extension||"",password:e.password,access_token_ttl:this.accessTokenTtl,refresh_token_ttl:e.remember?this.refreshTokenTtlRemember:this.refreshTokenTtl}}).then(function(t){return this.setCache(t.data).remember(e.remember).emitAndCallback(this.events.authorizeSuccess,[]),t}.bind(this)).catch(function(e){throw this.clearStorage().emitAndCallback(this.events.authorizeError,[e]),e}.bind(this))},t.prototype.isPaused=function(){var e=this.getStorage(),t=this.cacheId+"-refresh";return!!e.getItem(t)&&Date.now()-parseInt(e.getItem(t))<this.releaseTimeout},t.prototype.pause=function(){return this.getStorage().setItem(this.cacheId+"-refresh",Date.now()),this},t.prototype.resume=function(){return this.getStorage().removeItem(this.cacheId+"-refresh"),this},t.prototype.refresh=function(){return this.context.getPromise().resolve(null).then(function(e){if(this.isPaused())return this.refreshPolling(e);this.pause();var t=this.getAuthData();if(o.debug("Platform.refresh(): Performing token refresh (access token",t.access_token,", refresh token",t.refresh_token,")"),!t||!t.refresh_token)throw new Error("Refresh token is missing");if(Date.now()>t.refreshExpireTime)throw new Error("Refresh token has expired");return this.authCall({url:"/restapi/oauth/token",post:{grant_type:"refresh_token",refresh_token:t.refresh_token,access_token_ttl:this.accessTokenTtl,refresh_token_ttl:this.remember()?this.refreshTokenTtlRemember:this.refreshTokenTtl}}).then(function(e){if(o.info("Platform.refresh(): Token was refreshed"),!e.data||!e.data.refresh_token||!e.data.access_token){var t=new Error("Malformed OAuth response");throw t.ajax=e,t}return this.setCache(e.data).resume(),e}.bind(this))}.bind(this)).then(function(e){return this.emit(this.events.refreshSuccess,e),e}.bind(this)).catch(function(e){throw this.clearCacheOnRefreshError&&this.clearStorage(),this.emitAndCallback(this.events.accessViolation,[e]).emitAndCallback(this.events.refreshError,[e]),e}.bind(this))},t.prototype.logout=function(){return this.pause(),this.authCall({url:"/restapi/oauth/revoke",get:{token:this.getToken()}}).then(function(e){return this.resume().clearStorage().emit(this.events.logoutSuccess,e),e}.bind(this)).catch(function(e){throw this.resume().emitAndCallback(this.events.accessViolation,[e]).emitAndCallback(this.events.logoutError,[e]),e}.bind(this))},t.prototype.refreshPolling=function(e){return this.refreshPromise?this.refreshPromise:(this.refreshPromise=new(this.context.getPromise())(function(t,n){o.warn("Platform.refresh(): Refresh is already in progress polling started"),r.poll(function(r){return this.isPaused()?r():(this.refreshPromise=null,this.resume(),void(this.isTokenValid()?t(e):n(new Error("Automatic authentification timeout"))))}.bind(this),this.pollInterval)}.bind(this)),this.refreshPromise)},t.prototype.getToken=function(){return this.getAuthData().access_token},t.prototype.getTokenType=function(){return this.getAuthData().token_type},t.prototype.getAuthData=function(){return this.getStorage().getItem(this.cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},t.prototype.isTokenValid=function(){var e=this.getAuthData();return e.token_type==i||new Date(e.expireTime).getTime()-this.refreshHandicapMs>Date.now()},t.prototype.isAuthorized=function(){return this.isTokenValid()?this.context.getPromise().resolve(!0):this.refresh()},t.prototype.cancelAccessToken=function(){return this.setCache(r.extend(this.getAuthData(),{access_token:"",expires_in:0}))},t.prototype.setCache=function(e){var t=this.getAuthData();return o.info("Platform.setCache(): Tokens were updated, new:",e,", old:",t),e.expireTime=Date.now()+1e3*e.expires_in,e.refreshExpireTime=Date.now()+1e3*e.refresh_token_expires_in,this.getStorage().setItem(this.cacheId,e),this},t.prototype.forceAuthentication=function(){return this.setCache({token_type:i,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},t.prototype.apiCall=function(e){return e=e||{},e.url=this.apiUrl(e.url,{addServer:!0}),this.isAuthorized().then(function(){var t=this.getToken();return e.headers=e.headers||{},e.headers.Authorization=this.getTokenType()+(t?" "+t:""),this.getAjax().setOptions(e).send()}.bind(this)).catch(function(t){if(!t.ajax||!t.ajax.isUnauthorized())throw t;return this.cancelAccessToken(),this.refresh().then(function(){return this.apiCall(e)}.bind(this))}.bind(this))},t.prototype.authCall=function(e){return e=e||{},e.headers=r.extend({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorization:"Basic "+this.apiKey},e.headers||{}),e.method=e.method||"POST",e.post=r.queryStringify(e.post),e.url=this.apiUrl(e.url,{addServer:!0}),this.getAjax().setOptions(e).send()},t.prototype.apiUrl=function(e,t){e=e||"",t=t||{};var r="";return t.addServer&&-1==e.indexOf("http://")&&-1==e.indexOf("https://")&&(r+=this.server),-1==e.indexOf(this.urlPrefix)&&(r+=this.urlPrefix+"/"+this.apiVersion),e.indexOf(this.accountPrefix)>-1&&r.replace(this.accountPrefix+"~",this.accountPrefix+this.account),r+=e,(t.addMethod||t.addToken)&&(r+=e.indexOf("?")>-1?"&":"?"),t.addMethod&&(r+="_method="+t.addMethod),t.addToken&&(r+=(t.addMethod?"&":"")+"access_token="+this.getToken()),r},e={Class:t,$get:function(e){return e.createSingleton("Platform",function(){return new t(e)})}}}({}),core_Subscription=function(e){"use strict";function t(e){r.call(this),this.eventFilters=[],this.timeout=null,this.subscription={eventFilters:[],expirationTime:"",expiresIn:0,deliveryMode:{transportType:"PubNub",encryption:!1,address:"",subscriberKey:"",secretKey:""},id:"",creationTime:"",status:"",uri:""},this.socket=null,this.context=e}var r=core_Observable.Class,n=core_Log,o=core_Utils,i=6e4;return t.prototype=Object.create(r.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},t.prototype.createPubnub=function(e){return new(this.getPubnub().ws)(e)},t.prototype.getPubnub=function(){return this.context.getPubnub()},t.prototype.getCrypto=function(){return this.context.getCryptoJS()},t.prototype.getPlatform=function(){return core_Platform.$get(this.context)},t.prototype.register=function(e){return this.isSubscribed()?this.renew(e):this.subscribe(e)},t.prototype.addEvents=function(e){return this.eventFilters=this.eventFilters.concat(e),this},t.prototype.setEvents=function(e){return this.eventFilters=e,this},t.prototype.getFullEventFilters=function(){return this.eventFilters.map(function(e){return this.getPlatform().apiUrl(e)}.bind(this))},t.prototype.subscribe=function(e){return e=e||{},e.events&&(this.eventFilters=e.events),this.clearTimeout(),new(this.context.getPromise())(function(e){if(!this.eventFilters||!this.eventFilters.length)throw new Error("Events are undefined");e()}.bind(this)).then(function(){return this.getPlatform().apiCall({method:"POST",url:"/restapi/v1.0/subscription",post:{eventFilters:this.getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}})}.bind(this)).then(function(e){return this.updateSubscription(e.data).subscribeAtPubnub().emit(this.events.subscribeSuccess,e.data),e}.bind(this)).catch(function(e){throw this.unsubscribe().emit(this.events.subscribeError,e),e}.bind(this))},t.prototype.renew=function(e){return e=e||{},e.events&&(this.eventFilters=e.events),this.clearTimeout(),new(this.context.getPromise())(function(e){if(!this.subscription||!this.subscription.id)throw new Error("Subscription ID is required");if(!this.eventFilters||!this.eventFilters.length)throw new Error("Events are undefined");e()}.bind(this)).then(function(){return this.getPlatform().apiCall({method:"PUT",url:"/restapi/v1.0/subscription/"+this.subscription.id,post:{eventFilters:this.getFullEventFilters()}})}.bind(this)).then(function(e){return this.updateSubscription(e.data).emit(this.events.renewSuccess,e.data),e}.bind(this)).catch(function(e){throw this.unsubscribe().emit(this.events.renewError,e),e}.bind(this))},t.prototype.remove=function(e){return e=o.extend({async:!0},e),new(this.context.getPromise())(function(e){if(!this.subscription||!this.subscription.id)throw new Error("Subscription ID is required");e()}.bind(this)).then(function(){return this.getPlatform().apiCall({async:!!e.async,method:"DELETE",url:"/restapi/v1.0/subscription/"+this.subscription.id})}.bind(this)).then(function(e){return this.unsubscribe().emit(this.events.removeSuccess,e),e}.bind(this)).catch(function(e){throw this.unsubscribe().emit(this.events.removeError,e),e}.bind(this))},t.prototype.destroy=function(){return this.unsubscribe(),r.prototype.destroy.call(this)},t.prototype.isSubscribed=function(){return this.subscription&&this.subscription.deliveryMode&&this.subscription.deliveryMode.subscriberKey&&this.subscription.deliveryMode.address},t.prototype.setTimeout=function(){var e=1e3*this.subscription.expiresIn-i;this.timeout=setTimeout(function(){this.renew({})}.bind(this),e)},t.prototype.clearTimeout=function(){clearTimeout(this.timeout)},t.prototype.updateSubscription=function(e){return this.clearTimeout(),this.subscription=e,this.setTimeout(),this},t.prototype.unsubscribe=function(){return this.clearTimeout(),this.socket&&this.socket.close(this.socket.CLOSE_NORMAL,"Connection terminated by client"),this.subscription=null,this},t.prototype.notify=function(e){if(this.isSubscribed()&&this.subscription.deliveryMode.encryptionKey){var t=this.getCrypto(),r=t.enc.Base64.parse(this.subscription.deliveryMode.encryptionKey),n=t.enc.Base64.parse(e),o=t.AES.decrypt({ciphertext:n},r,{mode:t.mode.ECB,padding:t.pad.Pkcs7}).toString(t.enc.Utf8);e=JSON.parse(o)}return this.emit(this.events.notification,e),this},t.prototype.subscribeAtPubnub=function(){if(!this.isSubscribed())return this;var e="wss://pubsub.pubnub.com//"+this.subscription.deliveryMode.subscriberKey+"/"+this.subscription.deliveryMode.address;return this.socket=this.createPubnub(e),this.socket.pubnub&&this.socket.pubnub.ready(),this.socket.onmessage=function(e){n.info("Subscription: Socket received message",e),this.notify(e.data)}.bind(this),this.socket.onclose=function(){n.info("Subscription: Socket closed")},this.socket.onerror=function(e){n.error("Subscription: Socket error"),n.error(e.stack||e)},this.socket.onopen=function(){n.info("Subscription: Socket open")},this},e={Class:t,$get:function(e){return new t(e)}}}({}),core_PageVisibility=function(e){"use strict";function t(){function e(e){e=e||window.event;var r="visible",o="hidden",i={focus:r,focusin:r,pageshow:r,blur:o,focusout:o,pagehide:o};n.visible=e.type in i?i[e.type]==r:!document[t],n.emit(n.events.change,n.visible)}r.call(this);var t="hidden",n=this;this.visible=!0,"undefined"!=typeof document&&"undefined"!=typeof window&&(t in document?document.addEventListener("visibilitychange",e):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e)}var r=core_Observable.Class;return t.prototype=Object.create(r.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,enumerable:!1}),t.prototype.events={change:"change"},t.prototype.isVisible=function(){return this.visible},e={Class:t,$get:function(){return new t}}}({}),core_Helper=function(e){"use strict";function t(e){this.context=e}var r=core_Utils;return t.prototype.defaultProperty="id",t.prototype.getContext=function(){return this.context},t.prototype.createUrl=function(){return""},t.prototype.getId=function(e){return e&&e[this.defaultProperty]},t.prototype.isNew=function(e){return!this.getId(e)||!this.getUri(e)},t.prototype.resetAsNew=function(e){return e&&(delete e.id,delete e.uri),e},t.prototype.getUri=function(e){return e&&e.uri},t.prototype.parseMultipartResponse=function(e){return e.isMultipart()?e.data.filter(function(e){return!e.error}).map(function(e){return e.data}):[e.data]},t.prototype.loadRequest=function(e,t){return r.extend(t||{},{url:t&&t.url||e&&this.getUri(e)||this.createUrl(),method:t&&t.method||"GET"})},t.prototype.saveRequest=function(e,t){if(!(e||t&&t.post))throw new Error("No Object");return r.extend(t||{},{method:t&&t.method||(this.isNew(e)?"POST":"PUT"),url:t&&t.url||this.getUri(e)||this.createUrl(),post:t&&t.post||e})},t.prototype.deleteRequest=function(e,t){if(t=t||{},!(this.getUri(e)||t&&t.url))throw new Error("Object has to be not new or URL must be provided");return r.extend(t||{},{method:t&&t.method||"DELETE",url:t&&t.url||this.getUri(e)})},t.prototype.syncRequest=function(e){return e=e||{},e.url=e.url||this.createUrl({sync:!0}),e.get=e.get||{},e.get.syncToken?e.get={syncType:"ISync",syncToken:e.get.syncToken}:e.get.syncType="FSync",e},t.prototype.nextPageExists=function(e){return e&&e.navigation&&"nextPage"in e.navigation},t.prototype.index=function(e,t,r){return t=t||this.getId.bind(this),e=e||[],e.reduce(function(e,n){var o=t(n);return!o||e[o]&&!r?e:(r?(e[o]||(e[o]=[]),e[o].push(n)):e[o]=n,e)},{})},t.prototype.merge=function(e,t,n,o){n=n||this.getId.bind(this),e=e||[],t=t||[];var i=this.index(t,n),s=[],c=e.map(function(e){var t=n(e),c=i[t];return c&&s.push(t),c?o?r.extend(e,c):c:e});return t.forEach(function(e){-1==s.indexOf(n(e))&&c.push(e)}),c},e={Class:t,$get:function(e){return new t(e)}}}({}),core_Validator=function(e){"use strict";var t=core_Utils,r=e={validate:function(e){var t={errors:{},isValid:!0};return t.errors=e.reduce(function(e,r){var n=r.validator();return n.length>0&&(t.isValid=!1,e[r.field]=e[r.field]||[],e[r.field]=e[r.field].concat(n)),e},{}),t},email:function(e,r){return function(){return e?t.isEmail(e,r)?[]:[new Error("Value has to be a valid email")]:[]}},phone:function(e){return function(){return e?t.isPhoneNumber(e)?[]:[new Error("Value has to be a valid US phone number")]:[]}},required:function(e){return function(){return e?[]:[new Error("Field is required")]}},length:function(e,t,r){return function(){var n=[];return e?(e=e.toString(),r&&e.length<r&&n.push(new Error("Minimum length of "+r+" characters is required")),t&&e.length>t&&n.push(new Error("Maximum length of "+t+" characters is required")),n):n}},$get:function(){return r}};return e}({}),core_List=function(e){"use strict";var t=core_Utils,r=e={propertyExtractor:function(e){return function(t){return e?t&&t[e]||null:t}},stringComparator:function(e,r){return t.parseString(e).localeCompare(t.parseString(r))},numberComparator:function(e,r){return t.parseNumber(e)-t.parseNumber(r)
},comparator:function(e){function r(t,r){return e.compareFn(e.extractFn(t,e),e.extractFn(r,e),e)}return e=t.extend({extractFn:this.propertyExtractor(e&&e.sortBy||null),compareFn:this.stringComparator},e),r},equalsFilter:function(e,t){return t.condition===e},containsFilter:function(e,t){return e&&e.toString().indexOf(t.condition)>-1},regexpFilter:function(e,t){if(!(t.condition instanceof RegExp))throw new Error("Condition must be an instance of RegExp");return t.condition.test(e)},filter:function(e){function r(t){return e.reduce(function(e,r){return e&&r.condition?r.filterFn(r.extractFn(t,r),r):e},!0)}var n=this;return e=(e||[]).map(function(e){return t.extend({condition:"",extractFn:n.propertyExtractor(e&&e.filterBy||null),filterFn:n.equalsFilter},e)}),r},$get:function(){return r}};return e}({}),helpers_Country=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/dictionary/country"},e={Class:t,$get:function(e){return e.createSingleton("CountryHelper",function(){return new t(e)})}}}({}),helpers_DeviceModel=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.getId=function(e){return e?e.id+(e.addons&&e.addons[0]?"-"+e.addons[0].id+"-"+e.addons[0].count:""):null},t.prototype.cleanForSaving=function(e){return e?(delete e.name,delete e.deviceClass,e.addons&&e.addons.length>0?e.addons.forEach(function(t,r){delete e.addons[r].name}):delete e.addons,e):null},t.prototype.devices=[{id:"-1",name:"Softphone"},{id:"0",name:"Existing device"},{id:"19",name:"Cisco SPA-525G2 Desk Phone",deviceClass:"Desk Phone"},{id:"23",name:"Polycom IP 321 Basic IP phone",deviceClass:"Desk Phone"},{id:"30",name:"Polycom IP 550 HD Manager IP phone",deviceClass:"Desk Phone"},{id:"37",name:"Polycom IP 6000 Conference Phone",deviceClass:"Conference Phone"},{id:"40",name:"Polycom IP 335 HD IP phone",deviceClass:"Desk Phone"},{id:"51",name:"Cisco SPA-303 Desk Phone",deviceClass:"Desk Phone"},{id:"16",name:"Cisco SPA-508G Desk Phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"1"}]},{id:"16",name:"Cisco SPA-508G Desk Phone with 2 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"2"}]},{id:"16",name:"Cisco SPA-508G Desk Phone",deviceClass:"Desk Phone"},{id:"19",name:"Cisco SPA-525G2 Desk Phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"1"}]},{id:"19",name:"Cisco SPA-525G2 Desk Phone with 2 Expansion Modules	Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"2"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"1"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 2 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"2"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 3 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"3"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone",deviceClass:"Desk Phone"},{id:"52",name:"Cisco SPA-122 ATA",deviceClass:"Analog Adapter"},{id:"53",name:"Polycom VVX-500 Color Touchscreen",deviceClass:"Desk Phone"},{id:"54",name:"Polycom VVX-310 Gigabit Ethernet Phone",deviceClass:"Desk Phone"},{id:"55",name:"Polycom VVX-410 Color Gigabit Ethernet Phone",deviceClass:"Desk Phone"}],e={Class:t,$get:function(e){return e.createSingleton("DeviceModelHelper",function(){return new t(e)})}}}({}),helpers_Language=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.languages=[{id:"1033",name:"English (US)"},{id:"3084",name:"French (Canada)"}],e={Class:t,$get:function(e){return e.createSingleton("LanguageHelper",function(){return new t(e)})}}}({}),helpers_State=function(e){"use strict";function t(e){r.call(this,e),this.countryHelper=helpers_Country.$get(e)}var r=core_Helper.Class,n=core_List,o=core_Utils;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/dictionary/state"},t.prototype.filter=function(e){return e=o.extend({countryId:""},e),n.filter([{condition:e.countryId,filterFn:function(e,t){return this.countryHelper.getId(e.country)==t.condition}.bind(this)}])},e={Class:t,$get:function(e){return e.createSingleton("StateHelper",function(){return new t(e)})}}}({}),helpers_Location=function(e){"use strict";function t(e){r.call(this,e),this.state=helpers_State.$get(e)}var r=core_Helper.Class,n=core_List,o=core_Utils;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/dictionary/location"},t.prototype.filter=function(e){var t=[];return e=o.extend({stateId:"",onlyUniqueNPA:!1},e),n.filter([{condition:e.stateId,filterFn:function(e,t){return this.state.getId(e.state)==t.condition}.bind(this)},{condition:e.onlyUniqueNPA,filterFn:function(e){return-1==t.indexOf(e.npa)?(t.push(e.npa),!0):!1}}])},t.prototype.comparator=function(e){return e=o.extend({sortBy:"npa"},e),"nxx"==e.sortBy&&(e.extractFn=function(e){return 1e6*parseInt(e.npa)+parseInt(e.nxx)},e.compareFn=n.numberComparator),n.comparator(e)},e={Class:t,$get:function(e){return e.createSingleton("LocationHelper",function(){return new t(e)})}}}({}),helpers_ShippingMethod=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.shippingMethods=[{id:"1",name:"Ground Shipping (5-7 business days)"},{id:"2",name:"2-days Shipping"},{id:"3",name:"Overnight Shipping"}],e={Class:t,$get:function(e){return e.createSingleton("ShippingMethodHelper",function(){return new t(e)})}}}({}),helpers_Timezone=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/dictionary/timezone"},e={Class:t,$get:function(e){return e.createSingleton("TimezoneHelper",function(){return new t(e)})}}}({}),helpers_Account=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/account/~"},e={Class:t,$get:function(e){return e.createSingleton("AccountHelper",function(){return new t(e)})}}}({}),helpers_BlockedNumber=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class,n=core_Validator;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},"/account/~/extension/"+(e.extensionId?e.extensionId:"~")+"/blocked-number"+(t?"/"+t:"")},t.prototype.validate=function(e){return n.validate([{field:"phoneNumber",validator:n.phone(e.phoneNumber)},{field:"phoneNumber",validator:n.required(e.phoneNumber)},{field:"name",validator:n.required(e.name)}])},e={Class:t,$get:function(e){return e.createSingleton("BlockedNumberHelper",function(){return new t(e)})}}}({}),helpers_Extension=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class,n=core_List,o=core_Utils;return t.prototype=Object.create(r.prototype),t.prototype.type={department:"Department",user:"User",announcement:"Announcement",voicemail:"Voicemail"},t.prototype.createUrl=function(e,t){return e=e||{},"/account/~"+(e.departmentId?"/department/"+e.departmentId+"/members":"/extension")+(t?"/"+t:"")},t.prototype.isUser=function(e){return e&&e.type==this.type.user},t.prototype.isDepartment=function(e){return e&&e.type==this.type.department},t.prototype.isAnnouncement=function(e){return e&&e.type==this.type.announcement},t.prototype.isVoicemail=function(e){return e&&e.type==this.type.voicemail},t.prototype.comparator=function(e){return n.comparator(o.extend({sortBy:"extensionNumber",compareFn:n.numberComparator},e))},t.prototype.filter=function(e){return e=o.extend({search:"",type:""},e),n.filter([{filterBy:"type",condition:e.type},{condition:e.search.toLocaleLowerCase(),filterFn:n.containsFilter,extractFn:function(e){return(e.name&&e.name.toLocaleLowerCase()+" ")+(e.extensionNumber&&e.extensionNumber.toString().toLocaleLowerCase())}}])},e={Class:t,$get:function(e){return e.createSingleton("ExtensionHelper",function(){return new t(e)})}}}({}),helpers_Presence=function(e){"use strict";function t(e){r.call(this,e),this.extension=helpers_Extension.$get(e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},"/account/~/extension/"+(t||"~")+"/presence"+(e.detailed?"?detailedTelephonyState=true":"")},t.prototype.getId=function(e){return e&&this.extension.getId(e.extension)},t.prototype.isAvailable=function(e){return e&&"Available"==e.presenceStatus},t.prototype.getSubscription=function(e,t){return core_Subscription.$get(this.context).setEvents([this.createUrl(e,t)])},t.prototype.updateSubscription=function(e,t,r){var n=t.map(this.getId,this).map(function(e){return this.createUrl(r,e)},this);return e.addEvents(n),e},t.prototype.attachToExtensions=function(e,t){var r=this.index(t);e.forEach(function(e){var t=r[this.extension.getId(e)];t&&(e.presence=t)},this)},t.prototype.isCallInProgress=function(e){return e&&"NoCall"!=e.telephonyStatus},e={Class:t,$get:function(e){return e.createSingleton("PresenceHelper",function(){return new t(e)})}}}({}),helpers_Contact=function(e){"use strict";function t(e){o.call(this,e)}var r=core_Utils,n=core_Validator,o=core_Helper.Class,i=core_List;return t.prototype=Object.create(o.prototype),t.prototype.createUrl=function(e,t){e=e||{};var r="/account/~/extension/"+(e.extensionId?e.extensionId:"~")+"/address-book";return e.sync?r+"-sync":r+(e.groupId?"/group/"+e.groupId+"/contact":"/contact")+(t?"/"+t:"")},t.prototype.getFieldValues=function(e,t,r){return t.reduce(function(t,n){return e&&e[n]&&(r?t[n]=e[n]:t.push(e[n])),t},r?{}:[])},t.prototype.getFullName=function(e){return this.getFieldValues(e,this.nameFields).join(" ")},t.prototype.getEmails=function(e,t){return this.getFieldValues(e,this.emailFields,t)},t.prototype.getPhones=function(e,t){return this.getFieldValues(e,this.phoneFields,t)},t.prototype.getFaxes=function(e,t){return this.getFieldValues(e,this.faxFields,t)},t.prototype.getAddresses=function(e,t){return this.getFieldValues(e,this.addressFields,t)},t.prototype.isAlive=function(e){return"Alive"==e.availability},t.prototype.match=function(e,t,n){function o(e){if(!i){var r=n.transformFn(e,n);if(r){var o=n.strict?r==t:r.indexOf(t)>-1;o&&(i=e)}}}n=r.extend({fields:[].concat(this.nameFields,this.emailFields,this.phoneFields,this.faxFields,this.otherFields),inAddresses:!0,transformFn:function(e){return e?e.toString().toLocaleLowerCase():""},strict:!1},n),t=n.transformFn(t,n);var i=null;return t?(n.fields.forEach(function(t){o(e[t])}),n.inAddresses&&!i&&this.addressFields.forEach(function(t){e[t]&&!i&&this.addressSubFields.forEach(function(r){o(e[t][r])})},this),i):i},t.prototype.matchAsPhone=function(e,t,n){return this.match(e,t,r.extend({fields:[].concat(this.phoneFields,this.faxFields),inAddresses:!1,transformFn:function(e){return e?e.toString().replace(/[^\d\w]/gi,""):""},strict:!1},n))},t.prototype.attachToCallerInfos=function(e,t,n){var o=this,i=this.index(e,function(e){return e.phoneNumber},!0);r.forEach(i,function(e,r){var i=null,s=null;t.some(function(e){return s=o.matchAsPhone(e,r,n),s&&(i=e),s}),i&&e.forEach(function(e){e.contact=i,e.contactPhone=s})})},t.prototype.comparator=function(e){var t=this;return i.comparator(r.extend({extractFn:function(e){return t.getFullName(e)}},e))},t.prototype.filter=function(e){var t=this;return e=r.extend({alive:!0,startsWith:"",phonesOnly:!1,faxesOnly:!1},e),i.filter([{condition:e.alive,filterFn:this.isAlive},{condition:e.startsWith,filterFn:function(e,r){return t.match(e,r.condition)}},{condition:e.phonesOnly,filterFn:function(e){return t.getPhones(e).length>0}},{condition:e.faxesOnly,filterFn:function(e){return t.getFaxes(e).length>0}}])},t.prototype.validate=function(e){return n.validate([{field:"firstName",validator:n.required(e.firstName)},{field:"lastName",validator:n.required(e.lastName)},{field:"email",validator:n.email(e.email)},{field:"email2",validator:n.email(e.email2)},{field:"email3",validator:n.email(e.email3)}])},t.prototype.phoneFields=["homePhone","homePhone2","businessPhone","businessPhone2","mobilePhone","companyPhone","assistantPhone","carPhone","otherPhone","callbackPhone"],t.prototype.faxFields=["businessFax","otherFax"],t.prototype.addressFields=["homeAddress","businessAddress","otherAddress"],t.prototype.addressSubFields=["street","city","state","zip"],t.prototype.nameFields=["firstName","middleName","lastName","nickName"],t.prototype.otherFields=["company","jobTitle","webPage","notes"],t.prototype.emailFields=["email","email2","email3"],e={Class:t,$get:function(e){return e.createSingleton("ContactHelper",function(){return new t(e)})}}}({}),helpers_Call=function(e){"use strict";function t(e){r.call(this,e),this.presence=helpers_Presence.$get(e),this.contact=helpers_Contact.$get(e)}var r=core_Helper.Class,n=core_Utils,o=core_List;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},"personal"in e||"extensionId"in e||(e.personal=!0),"/account/~/"+(e.personal||e.extensionId?"extension/"+(e.extensionId||"~")+"/":"")+(e.active?"active-calls":"call-log")+(t?"/"+t:"")},t.prototype.getSessionId=function(e){return e&&e.sessionId},t.prototype.isInProgress=function(e){return e&&"In Progress"==e.result},t.prototype.isAlive=function(e){return e&&"Alive"==e.availability},t.prototype.isInbound=function(e){return e&&"Inbound"==e.direction},t.prototype.isOutbound=function(e){return!this.isInbound(e)},t.prototype.isMissed=function(e){return e&&"Missed"==e.result},t.prototype.isFindMe=function(e){return e&&"FindMe"==e.action},t.prototype.getCallerInfo=function(e){return this.isInbound(e)?e.from:e.to},t.prototype.getAllCallerInfos=function(e){return[this.getCallerInfo(e)].concat(this.isInbound(e)?e.to:e.from)},t.prototype.formatDuration=function(e){function t(e){return 10>e?"0"+e:e}var r=parseInt(e.duration),n=Math.floor(r/3600),o=Math.floor(r%3600/60),i=Math.floor(r%60);return(n?n+":":"")+t(o)+":"+t(i)},t.prototype.filter=function(e){return e=n.extend({alive:!0,direction:"",type:""},e),o.filter([{filterBy:"direction",condition:e.direction},{filterBy:"type",condition:e.type}])},t.prototype.comparator=function(e){return o.comparator(n.extend({sortBy:"startTime"},e))},t.prototype.attachContacts=function(e,t,r){var n=this,o=t.reduce(function(e,t){return e.concat(n.getAllCallerInfos(t))},[]);this.contact.attachToCallerInfos(o,e,r)},t.prototype.checkMergeability=function(e,t,r){function n(e){return new Date(e).getTime()}return(!r.strict||e.action&&-1!=e.action.toLowerCase().indexOf("ringout"))&&"Outbound"==e.direction&&"Inbound"==t.direction&&(!t.startTime&&!e.startTime||Math.abs(n(t.startTime)-n(e.startTime))<(r.maxStartTimeDiscrepancy||5e3))&&t.from.phoneNumber==e.to.phoneNumber&&(t.to.phoneNumber==e.from.phoneNumber||t.to.name==e.from.name)},t.prototype.combineCalls=function(e,t,r){r=r||{};var n=[];return e.hasSubsequent=!0,r.merge?(e.duration=e.duration>t.duration?e.duration:t.duration,e.from=t.to,e.to=t.from,n.push(e)):(t.subsequent=!0,t.startTime=e.startTime,n.push(e),n.push(t)),n},t.prototype.processCalls=function(e,t){var r=[],n=[],o=this;return e.forEach(function(i){var s=!1;i.subsequent=!1,i.hasSubsequent=!1,e.some(function(e){return i===e?!1:(o.checkMergeability(i,e,t)&&(r=r.concat(o.combineCalls(i,e,t)),n.push(i),n.push(e),s=!0),s)})}),e.forEach(function(e){-1==n.indexOf(e)&&r.push(e)}),r},t.prototype.parsePresenceCalls=function(e){return e.map(function(e){return{id:e.id,uri:"",sessionId:e.sessionId,from:{phoneNumber:e.from},to:{phoneNumber:e.to},direction:e.direction,startTime:"",duration:0,type:"",action:"",result:this.presence.isCallInProgress(e)?"In Progress":e.telephonyStatus,telephonyStatus:e.telephonyStatus}},this)},t.prototype.getSignature=function(e){function t(e){return(e||"").toString().replace(/[^0-9]/gi,"")}return e.direction+"|"+(e.from&&t(e.from.phoneNumber))+"|"+(e.to&&t(e.to.phoneNumber))},t.prototype.mergePresenceCalls=function(e,t){var r=new Date,n=this.parsePresenceCalls(t&&t.activeCalls||[]).map(function(e){return delete e.startTime,e});return e=this.merge(e||[],n,this.getSessionId,!0),e.forEach(function(e){e.startTime||(e.startTime=r.toISOString())}),e},t.prototype.mergeAll=function(e,t,r){var n=this.merge(e||[],t||[],this.getSessionId,!0);return this.merge(n,r||[],this.getSessionId,!0)},e={Class:t,$get:function(e){return e.createSingleton("CallHelper",function(){return new t(e)})}}}({}),helpers_Conferencing=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(){return"/account/~/extension/~/conferencing"},e={Class:t,$get:function(e){return e.createSingleton("ConferencingHelper",function(){return new t(e)})}}}({}),helpers_ContactGroup=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class,n=core_Validator;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return"/account/~/extension/~/address-book/group"+(t?"/"+t:"")},t.prototype.validate=function(e){return n.validate([{field:"groupName",validator:n.required(e&&e.groupName)}])},e={Class:t,$get:function(e){return e.createSingleton("ContactGroupHelper",function(){return new t(e)})}}}({}),helpers_Device=function(e){"use strict";function t(e){r.call(this,e),this.extension=helpers_Extension.$get(e),this.deviceModel=helpers_DeviceModel.$get(e)}var r=core_Helper.Class,n=core_Validator;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},e.order?"/account/~/order":"/account/~"+(e.extensionId?"/extension/"+e.extensionId:"")+"/device"+(t?"/"+t:"")},t.prototype.validate=function(e){return n.validate([{field:"emergencyServiceAddress-street",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.street)},{field:"emergencyServiceAddress-city",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.city)},{field:"emergencyServiceAddress-state",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.state)},{field:"emergencyServiceAddress-country",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.country)},{field:"emergencyServiceAddress-zip",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.zip)},{field:"emergencyServiceAddress-customerName",validator:n.required(e&&e.emergencyServiceAddress&&e.emergencyServiceAddress.customerName)},{field:"extension",validator:n.required(this.extension.getId(e&&e.extension))},{field:"model",validator:n.required(this.deviceModel.getId(e&&e.model))}])},e={Class:t,$get:function(e){return e.createSingleton("DeviceHelper",function(){return new t(e)})}}}({}),helpers_ForwardingNumber=function(e){"use strict";function t(e){r.call(this,e)}var r=core_Helper.Class,n=core_Utils,o=core_List;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},"/account/~/extension/"+(e.extensionId||"~")+"/forwarding-number"+(t?"/"+t:"")},t.prototype.getId=function(e){return e.id||e.phoneNumber},t.prototype.hasFeature=function(e,t){return!!e.features&&-1!=e.features.indexOf(t)},t.prototype.comparator=function(e){return o.comparator(n.extend({sortBy:"label"},e))},t.prototype.filter=function(e){var t=this;return e=n.extend({features:[]},e),o.filter([{condition:e.features.length,filterFn:function(r){return e.features.some(function(e){return t.hasFeature(r,e)})}}])},e={Class:t,$get:function(e){return e.createSingleton("ForwardingNumberHelper",function(){return new t(e)})}}}({}),helpers_Message=function(e){"use strict";function t(e){r.call(this,e),this.platform=core_Platform.$get(e),this.contact=helpers_Contact.$get(e)}var r=core_Helper.Class,n=core_Validator,o=core_Utils,i=core_List;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){e=e||{};var r="/account/~/extension/"+(e.extensionId||"~");return e.fax?r+"/fax":e.sms?r+"/sms":e.pager?r+"/company-pager":e.sync?r+"/message-sync":r+"/message-store"+(t?"/"+t:"")},t.prototype.isInbound=function(e){return e&&"Inbound"==e.direction},t.prototype.isOutbound=function(e){return!this.isInbound(e)},t.prototype.isSMS=function(e){return e&&"SMS"==e.type},t.prototype.isPager=function(e){return e&&"Pager"==e.type},t.prototype.isVoiceMail=function(e){return e&&"VoiceMail"==e.type},t.prototype.isFax=function(e){return e&&"Fax"==e.type},t.prototype.isAlive=function(e){return e&&"Alive"==e.availability},t.prototype.isRead=function(e){return"Read"==e.readStatus},t.prototype.setIsRead=function(e,t){return e.readStatus=t?"Read":"Unread",e},t.prototype.getAttachmentUrl=function(e,t){return e.attachments[t]?this.platform.apiUrl(e.attachments[t].uri,{addMethod:"GET",addServer:!0,addToken:!0}):""},t.prototype.getAttachmentContentType=function(e,t){return e.attachments[t]?e.attachments[t].contentType:""},t.prototype.getSubscription=function(e){return core_Subscription.$get(this.context).setEvents([this.createUrl(e)])},t.prototype.getCallerInfos=function(e){return this.isInbound(e)?[e.from]:e.to},t.prototype.getAllCallerInfos=function(e){return this.getCallerInfos(e).concat(this.isInbound(e)?e.to:[e.from])},t.prototype.comparator=function(e){return i.comparator(o.extend({sortBy:"creationTime"},e))},t.prototype.filter=function(e){return e=o.extend({search:"",alive:!0,direction:"",conversationId:"",readStatus:""},e),i.filter([{condition:e.alive,filterFn:this.isAlive},{filterBy:"type",condition:e.type},{filterBy:"direction",condition:e.direction},{filterBy:"conversationId",condition:e.conversationId},{filterBy:"readStatus",condition:e.readStatus},{filterBy:"subject",condition:e.search,filterFn:i.containsFilter}])},t.prototype.attachContacts=function(e,t,r){var n=this,o=t.reduce(function(e,t){return e.concat(n.getAllCallerInfos(t))},[]);this.contact.attachToCallerInfos(o,e,r)},t.prototype.shorten=function(e){return{from:e.from,to:e.to,text:e.subject}},t.prototype.validateSMS=function(e){return n.validate([{field:"to",validator:n.required(o.getProperty(e,"to[0].phoneNumber"))},{field:"from",validator:n.required(o.getProperty(e,"from.phoneNumber"))},{field:"subject",validator:n.required(o.getProperty(e,"subject"))},{field:"subject",validator:n.length(o.getProperty(e,"subject"),160)}])},t.prototype.validatePager=function(e){return n.validate([{field:"to",validator:n.required(o.getProperty(e,"to.extensionNumber"))},{field:"from",validator:n.required(o.getProperty(e,"from.extensionNumber"))},{field:"subject",validator:n.required(o.getProperty(e,"subject"))},{field:"subject",validator:n.length(o.getProperty(e,"subject"),160)}])},e={Class:t,$get:function(e){return e.createSingleton("MessageHelper",function(){return new t(e)})}}}({}),helpers_PhoneNumber=function(e){"use strict";function t(e){o.call(this,e),this.extension=helpers_Extension.$get(e)}var r=core_List,n=core_Utils,o=core_Helper.Class;return t.prototype=Object.create(o.prototype),t.prototype.createUrl=function(e,t){return e=e||{},e.lookup?"/number-pool/lookup":"/account/~"+(e.extensionId?"/extension/"+e.extensionId:"")+"/phone-number"+(t?"/"+t:"")},t.prototype.isSMS=function(e){return this.hasFeature(e,"SmsSender")},t.prototype.hasFeature=function(e,t){return!!e.features&&-1!=e.features.indexOf(t)},t.prototype.reserve=function(e,t){e.reservedTill=new Date(t).toISOString()},t.prototype.unreserve=function(e){e.reservedTill=null},t.prototype.comparator=function(e){return r.comparator(n.extend({extractFn:function(e){return e.usageType+"-"+e.paymentType+"-"+e.type}},e))},t.prototype.filter=function(e){var t=this;return e=n.extend({usageType:"",paymentType:"",type:"",features:[]},e),r.filter([{filterBy:"usageType",condition:e.usageType},{filterBy:"paymentType",condition:e.paymentType},{filterBy:"type",condition:e.type},{condition:e.features.length,filterFn:function(r){return e.features.some(function(e){return t.hasFeature(r,e)})}}])},e={Class:t,$get:function(e){return e.createSingleton("PhoneNumberHelper",function(){return new t(e)})}}}({}),helpers_Ringout=function(e){"use strict";function t(e){r.call(this,e),this.extension=helpers_Extension.$get(e)}var r=core_Helper.Class,n=core_Validator;return t.prototype=Object.create(r.prototype),t.prototype.createUrl=function(e,t){return e=e||{},"/account/~/extension/"+(e.extensionId||"~")+"/ringout"+(t?"/"+t:"")},t.prototype.resetAsNew=function(e){return e=r.prototype.resetAsNew.call(this,e),e&&delete e.status,e},t.prototype.isInProgress=function(e){return e&&!this.isNew(e)&&e.status&&"InProgress"==e.status.callStatus},t.prototype.isSuccess=function(e){return e&&!this.isNew(e)&&e.status&&"Success"==e.status.callStatus},t.prototype.isError=function(e){return!this.isNew(e)&&!this.isInProgress(e)&&!this.isSuccess(e)},t.prototype.validate=function(e){return n.validate([{field:"to",validator:n.required(e&&e.to&&e.to.phoneNumber)},{field:"from",validator:n.required(e&&e.from&&e.from.phoneNumber)}])},e={Class:t,$get:function(e){return e.createSingleton("RingoutHelper",function(){return new t(e)})}}}({}),helpers_Service=function(e){"use strict";function t(e){n.call(this,e)}function r(e){return function(t){return this.isEnabled(e,t)}}var n=core_Helper.Class;return t.prototype=Object.create(n.prototype),t.prototype.createUrl=function(){return"/account/~/service-info"},t.prototype.isEnabled=function(e,t){return t.reduce(function(t,r){return r.featureName==e&&(t=r.enabled),t},!1)},t.prototype.isSmsEnabled=r("SMS"),t.prototype.isSmsReceivingEnabled=r("SMSReceiving"),t.prototype.isPresenceEnabled=r("Presence"),t.prototype.isRingOutEnabled=r("RingOut"),t.prototype.isInternationalCallingEnabled=r("InternationalCalling"),t.prototype.isDndEnabled=r("DND"),t.prototype.isFaxEnabled=r("Fax"),t.prototype.isFaxReceivingEnabled=r("FaxReceiving"),t.prototype.isVoicemailEnabled=r("Voicemail"),t.prototype.isPagerEnabled=r("Pager"),t.prototype.isPagerReceivingEnabled=r("PagerReceiving"),t.prototype.isVoipCallingEnabled=r("VoipCalling"),t.prototype.isVideoConferencingEnabled=r("VideoConferencing"),t.prototype.isSalesForceEnabled=r("SalesForce"),t.prototype.isIntercomEnabled=r("Intercom"),t.prototype.isPagingEnabled=r("Paging"),t.prototype.isConferencingEnabled=r("Conferencing"),t.prototype.isFreeSoftPhoneLinesEnabled=r("FreeSoftPhoneLines"),t.prototype.isHipaaComplianceEnabled=r("HipaaCompliance"),t.prototype.isCallParkEnabled=r("CallPark"),t.prototype.isOnDemandCallRecordingEnabled=r("OnDemandCallRecording"),e={Class:t,$get:function(e){return e.createSingleton("serviceHelper",function(){return new t(e)})}}}({}),RCSDK=function(e){"use strict";return e=function(e){function t(){this._context=core_Context.$get(e)}function r(){return c.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(r){}throw new Error("This browser does not support XMLHttpRequest.")}}function n(){return c.CryptoJS||"undefined"!=typeof CryptoJS&&CryptoJS}function o(){return c.localStorage}function i(){return c.PUBNUB||"undefined"!=typeof PUBNUB&&PUBNUB}function s(){return c.Promise}t.version="0.15.5",t.prototype.getContext=function(){return this._context},t.prototype.getAjax=function(){return core_Ajax.$get(this.getContext())},t.prototype.getAjaxObserver=function(){return core_AjaxObserver.$get(this.getContext())},t.prototype.getXhrResponse=function(){return core_xhr_XhrResponse.$get(this.getContext())},t.prototype.getPlatform=function(){return core_Platform.$get(this.getContext())},t.prototype.getCache=function(){return core_Cache.$get(this.getContext())},t.prototype.getSubscription=function(){return core_Subscription.$get(this.getContext())},t.prototype.getPageVisibility=function(){return core_PageVisibility.$get(this.getContext())},t.prototype.getHelper=function(){return core_Helper.$get(this.getContext())},t.prototype.getObservable=function(){return core_Observable.$get(this.getContext())},t.prototype.getValidator=function(){return core_Validator.$get(this.getContext())},t.prototype.getLog=function(){return core_Log.$get(this.getContext())},t.prototype.getUtils=function(){return core_Utils.$get(this.getContext())},t.prototype.getList=function(){return core_List.$get(this.getContext())},t.prototype.getCountryHelper=function(){return helpers_Country.$get(this.getContext())},t.prototype.getDeviceModelHelper=function(){return helpers_DeviceModel.$get(this.getContext())},t.prototype.getLanguageHelper=function(){return helpers_Language.$get(this.getContext())},t.prototype.getLocationHelper=function(){return helpers_Location.$get(this.getContext())},t.prototype.getShippingMethodHelper=function(){return helpers_ShippingMethod.$get(this.getContext())},t.prototype.getStateHelper=function(){return helpers_State.$get(this.getContext())},t.prototype.getTimezoneHelper=function(){return helpers_Timezone.$get(this.getContext())},t.prototype.getAccountHelper=function(){return helpers_Account.$get(this.getContext())},t.prototype.getBlockedNumberHelper=function(){return helpers_BlockedNumber.$get(this.getContext())},t.prototype.getCallHelper=function(){return helpers_Call.$get(this.getContext())},t.prototype.getConferencingHelper=function(){return helpers_Conferencing.$get(this.getContext())},t.prototype.getContactHelper=function(){return helpers_Contact.$get(this.getContext())},t.prototype.getContactGroupHelper=function(){return helpers_ContactGroup.$get(this.getContext())},t.prototype.getDeviceHelper=function(){return helpers_Device.$get(this.getContext())},t.prototype.getExtensionHelper=function(){return helpers_Extension.$get(this.getContext())},t.prototype.getForwardingNumberHelper=function(){return helpers_ForwardingNumber.$get(this.getContext())},t.prototype.getMessageHelper=function(){return helpers_Message.$get(this.getContext())},t.prototype.getPhoneNumberHelper=function(){return helpers_PhoneNumber.$get(this.getContext())},t.prototype.getPresenceHelper=function(){return helpers_Presence.$get(this.getContext())},t.prototype.getRingoutHelper=function(){return helpers_Ringout.$get(this.getContext())},t.prototype.getServiceHelper=function(){return helpers_Service.$get(this.getContext())};var c=new Function("return this")();return e=e||{},e.CryptoJS=e.CryptoJS||n(),e.localStorage=e.localStorage||o(),e.Promise=e.Promise||s(),e.PUBNUB=e.PUBNUB||i(),e.XHR=e.XHR||r(),t}}({}),function(){"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=RCSDK({CryptoJS:require("crypto-js"),localStorage:new(require("dom-storage")),Promise:require("es6-promise").Promise,PUBNUB:require("pubnub"),XHR:require("xhr2")})):"function"==typeof define&&define.amd?define(["crypto-js","pubnub","es6-promise"],function(e,t){return RCSDK({CryptoJS:e,PUBNUB:t})}):(RCSDK.noConflict=function(e){return function(){return root.RCSDK=e,RCSDK.noConflict=void 0,RCSDK}}(root.RCSDK),root.RCSDK=RCSDK({}))}()}(this);
//# sourceMappingURL=rc-sdk.min.js.map