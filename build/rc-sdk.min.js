!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("es6-promise"),require("pubnub"),require("crypto-js/aes"),require("crypto-js/mode-ecb"),require("crypto-js/core"),function(){try{return require("xhr2")}catch(t){}}(),require("dom-storage")):"function"==typeof define&&define.amd?define(["es6-promise","pubnub","crypto-js/aes","crypto-js/mode-ecb","crypto-js/core","empty:","empty:"],e):"object"==typeof exports?exports.RCSDK=e(require("es6-promise"),require("pubnub"),require("crypto-js/aes"),require("crypto-js/mode-ecb"),require("crypto-js/core"),function(){try{return require("xhr2")}catch(t){}}(),require("dom-storage")):t.RCSDK=e(t.Promise,t.PUBNUB,t.CryptoJS.AES,t.CryptoJS.mode.ECB,t.CryptoJS,t.XMLHttpRequest,t.localStorage)}(this,function(t,e,n,r,o,i,s){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r=n(1),o=n(2),i=n(8);n(3),n(4);var s=n(5),u="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(r){}try{return n(6)}catch(r){}throw new Error("This browser does not support XMLHttpRequest.")};e=t.exports=i.factory({CryptoJS:s,localStorage:"undefined"!=typeof localStorage?localStorage:n(7),Promise:"undefined"!=typeof Promise?Promise:r.Promise,PUBNUB:o,XHR:u})},function(e){e.exports=t},function(t){t.exports=e},function(t){t.exports=n},function(t){t.exports=r},function(t){t.exports=o},function(t){if("undefined"==typeof i){var e=new Error('Cannot find module "undefined"');throw e.code="MODULE_NOT_FOUND",e}t.exports=i},function(t){t.exports=s},function(t,e,n){function r(t){if(!(t&&"CryptoJS"in t&&"localStorage"in t&&"Promise"in t&&"PUBNUB"in t&&"XHR"in t))throw new Error("Injections object is not complete");return j.setInjections(t)}var o=n(9),i=n(10),s=n(11),u=n(12),a=n(13),c=n(14),p=n(15),h=n(16),l=n(17),f=n(18),d=n(19),y=n(20),g=n(21),m=n(22),v=n(23),b=n(24),x=n(25),S=n(26),w=n(27),P=n(28),C=n(29),E=n(30),T=n(31),A=n(32),I=n(33),F=n(34),k=n(35),O=n(36),H=n(37),$=n(38),_=n(39),M=n(40),q=n(41),N=n(42),j=function(){function t(e){e=e||{},this._context=u.$get(t.injections),this.getCache().setPrefix(e.cachePrefix||""),this.getPlatform().setServer(e.server||"").setCredentials(e.appKey||"",e.appSecret||"")}return t.setInjections=function(t){return this.injections=t,this},t.prototype.getContext=function(){return this._context},t.prototype.getAjaxObserver=function(){return i.$get(this.getContext())},t.prototype.getXhrResponse=function(){return o.$get(this.getContext())},t.prototype.getPlatform=function(){return f.$get(this.getContext())},t.prototype.getCache=function(){return s.$get(this.getContext())},t.prototype.getSubscription=function(){return d.$get(this.getContext())},t.prototype.getPageVisibility=function(){return l.$get(this.getContext())},t.prototype.getHelper=function(){return a.$get(this.getContext())},t.prototype.getObservable=function(){return h.$get(this.getContext())},t.prototype.getValidator=function(){return g.$get(this.getContext())},t.prototype.getLog=function(){return p.$get(this.getContext())},t.prototype.getUtils=function(){return y.$get(this.getContext())},t.prototype.getList=function(){return c.$get(this.getContext())},t.prototype.getCountryHelper=function(){return P.$get(this.getContext())},t.prototype.getDeviceModelHelper=function(){return E.$get(this.getContext())},t.prototype.getLanguageHelper=function(){return I.$get(this.getContext())},t.prototype.getLocationHelper=function(){return F.$get(this.getContext())},t.prototype.getShippingMethodHelper=function(){return M.$get(this.getContext())},t.prototype.getStateHelper=function(){return q.$get(this.getContext())},t.prototype.getTimezoneHelper=function(){return N.$get(this.getContext())},t.prototype.getAccountHelper=function(){return m.$get(this.getContext())},t.prototype.getBlockedNumberHelper=function(){return v.$get(this.getContext())},t.prototype.getCallHelper=function(){return b.$get(this.getContext())},t.prototype.getConferencingHelper=function(){return w.$get(this.getContext())},t.prototype.getContactHelper=function(){return x.$get(this.getContext())},t.prototype.getContactGroupHelper=function(){return S.$get(this.getContext())},t.prototype.getDeviceHelper=function(){return C.$get(this.getContext())},t.prototype.getExtensionHelper=function(){return T.$get(this.getContext())},t.prototype.getForwardingNumberHelper=function(){return A.$get(this.getContext())},t.prototype.getMessageHelper=function(){return k.$get(this.getContext())},t.prototype.getPhoneNumberHelper=function(){return O.$get(this.getContext())},t.prototype.getPresenceHelper=function(){return H.$get(this.getContext())},t.prototype.getRingoutHelper=function(){return $.$get(this.getContext())},t.prototype.getServiceHelper=function(){return _.$get(this.getContext())},t.version="1.2.1",t}();e.RCSDK=j,e.factory=r},function(t,e){function n(t){return t.createSingleton("XhrResponse",function(){return new r(t)})}var r=function(){function t(){this.responses=[]}return t.prototype.add=function(t){this.responses.push(t)},t.prototype.clear=function(){this.responses=[]},t.prototype.find=function(t){var e;return this.responses.forEach(function(n){t.url.indexOf(n.path)>-1&&(!n.test||n.test(t))&&(e=n)}),e},t}();e.XhrResponse=r,e.$get=n},function(t,e,n){function r(t){return t.createSingleton("AjaxObserver",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(16),s=function(t){function e(){t.apply(this,arguments),this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}return o(e,t),e}(i.Observable);e.AjaxObserver=s,e.$get=r},function(t,e){function n(t){return t.createSingleton("Cache",function(){return new r(t)})}var r=function(){function t(t){this.setPrefix(),this.context=t,this.storage=t.getLocalStorage()}return t.prototype.setPrefix=function(t){return this.prefix=t||"rc-",this},t.prototype.prefixKey=function(t){return this.prefix+t},t.prototype.setItem=function(t,e){return this.storage.setItem(this.prefixKey(t),JSON.stringify(e)),this},t.prototype.removeItem=function(t){return this.storage.removeItem(this.prefixKey(t)),this},t.prototype.getItem=function(t){var e=this.storage.getItem(this.prefixKey(t));return e?JSON.parse(e):null},t.prototype.clean=function(){for(var t in this.storage)this.storage.hasOwnProperty(t)&&0===t.indexOf(this.prefix)&&(this.storage.removeItem(t),delete this.storage[t]);return this},t}();e.Cache=r,e.$get=n},function(t,e,n){function r(t){return new s(t)}var o=n(43),i=n(44),s=function(){function t(t){this.singletons={},this.injections=t,this.stubPubnub=!1,this.stubAjax=!1}return t.prototype.createSingleton=function(t,e){return this.singletons[t]||(this.singletons[t]=e()),this.singletons[t]},t.prototype.usePubnubStub=function(t){return this.stubPubnub=!!t,this},t.prototype.useAjaxStub=function(t){return this.stubAjax=!!t,this},t.prototype.getCryptoJS=function(){return this.injections.CryptoJS},t.prototype.getPubnub=function(){return this.stubPubnub?o.$get(this):this.injections.PUBNUB},t.prototype.getLocalStorage=function(){var t=this;return this.createSingleton("localStorage",function(){return"function"!=typeof t.injections.localStorage?t.injections.localStorage:new t.injections.localStorage})},t.prototype.getPromise=function(){return this.injections.Promise},t.prototype.getXHR=function(){return this.stubAjax?i.$get(this):new this.injections.XHR},t}();e.Context=s,e.$get=r},function(t,e,n){function r(t){return new i(t)}var o=n(20),i=function(){function t(t){this.defaultProperty="id",this.context=t,this.utils=o.$get(t)}return t.prototype.getContext=function(){return this.context},t.prototype.createUrl=function(){return""},t.prototype.getId=function(t){return t&&t[this.defaultProperty]},t.prototype.isNew=function(t){return!this.getId(t)||!this.getUri(t)},t.prototype.resetAsNew=function(t){return t&&(delete t.id,delete t.uri),t},t.prototype.getUri=function(t){return t&&t.uri},t.prototype.parseMultipartResponse=function(t){return t.isMultipart()?t.data.filter(function(t){return!t.error}).map(function(t){return t.data}):[t.data]},t.prototype.loadRequest=function(t,e){return this.utils.extend(e||{},{url:e&&e.url||t&&this.getUri(t)||this.createUrl(),method:e&&e.method||"GET"})},t.prototype.saveRequest=function(t,e){if(!(t||e&&(e.post||e.body)))throw new Error("No Object");return this.utils.extend(e||{},{method:e&&e.method||(this.isNew(t)?"POST":"PUT"),url:e&&e.url||this.getUri(t)||this.createUrl(),body:e&&(e.body||e.post)||t})},t.prototype.deleteRequest=function(t,e){if(e=e||{},!(this.getUri(t)||e&&e.url))throw new Error("Object has to be not new or URL must be provided");return this.utils.extend(e||{},{method:e&&e.method||"DELETE",url:e&&e.url||this.getUri(t)})},t.prototype.syncRequest=function(t){return t=t||{},t.url=t.url||this.createUrl({sync:!0}),t.query=t.query||t.get||{},t.query.syncToken?t.query={syncType:"ISync",syncToken:t.get.syncToken}:t.query.syncType="FSync",t},t.prototype.nextPageExists=function(t){return t&&t.navigation&&"nextPage"in t.navigation},t.prototype.index=function(t,e,n){return e=e||this.getId.bind(this),t=t||[],t.reduce(function(t,r){var o=e(r);return!o||t[o]&&!n?t:(n?(t[o]||(t[o]=[]),t[o].push(r)):t[o]=r,t)},{})},t.prototype.merge=function(t,e,n,r){var o=this;n=n||this.getId.bind(this),t=t||[],e=e||[];var i=this.index(e,n),s=[],u=t.map(function(t){var e=n(t),u=i[e];return u&&s.push(e),u?r?o.utils.extend(t,u):u:t});return e.forEach(function(t){-1==s.indexOf(n(t))&&u.push(t)}),u},t}();e.Helper=i,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("List",function(){return new i(t)})}var o=n(20),i=function(){function t(t){this.context=t,this.utils=o.$get(t),this.numberComparator=this.numberComparator.bind(this),this.stringComparator=this.stringComparator.bind(this)}return t.prototype.propertyExtractor=function(t){return function(e){return t?e&&e[t]||null:e}},t.prototype.stringComparator=function(t,e){return this.utils.parseString(t).localeCompare(this.utils.parseString(e))},t.prototype.numberComparator=function(t,e){return this.utils.parseNumber(t)-this.utils.parseNumber(e)},t.prototype.comparator=function(t){return t=this.utils.extend({extractFn:this.propertyExtractor(t&&t.sortBy||null).bind(this),compareFn:this.stringComparator.bind(this)},t),function(e,n){return t.compareFn(t.extractFn(e,t),t.extractFn(n,t),t)}},t.prototype.equalsFilter=function(t,e){return e.condition===t},t.prototype.containsFilter=function(t,e){return t&&t.toString().indexOf(e.condition)>-1},t.prototype.regexpFilter=function(t,e){if(!(e.condition instanceof RegExp))throw new Error("Condition must be an instance of RegExp");return e.condition.test(t)},t.prototype.filter=function(t){var e=this,n=this;return t=(t||[]).map(function(t){return e.utils.extend({condition:"",extractFn:n.propertyExtractor(t&&t.filterBy||null).bind(e),filterFn:n.equalsFilter.bind(e)},t)}),function(e){return t.reduce(function(t,n){return t&&n.condition?n.filterFn(n.extractFn(e,n),n):t},!0)}},t}();e.List=i,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Log",function(){return new i(t,console)})}var o=n(20),i=function(){function t(t,e){e||(e={log:function(){},warn:function(){},info:function(){},error:function(){}}),this.context=t,this.console=e,this.utils=o.$get(t),this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1,this.addTimestamps=!1}return t.prototype.disableAll=function(){this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1},t.prototype.enableAll=function(){this.logDebug=!0,this.logInfo=!0,this.logWarnings=!0,this.logErrors=!0},t.prototype.parseArguments=function(t){return t=this.utils.argumentsToArray(t),this.addTimestamps&&t.unshift((new Date).toLocaleString(),"-"),t},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.logDebug&&this.console.log.apply(this.console,this.parseArguments(arguments))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.logInfo&&this.console.info.apply(this.console,this.parseArguments(arguments))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.logWarnings&&this.console.warn.apply(this.console,this.parseArguments(arguments))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];this.logErrors&&this.console.error.apply(this.console,this.parseArguments(arguments))},t}();e.Log=i,e.$get=r},function(t,e,n){function r(t){return new s(t)}var o=n(20),i=n(15),s=function(){function t(e){if(!(this instanceof t))throw new Error("Observable(): New operator was omitted");Object.defineProperty(this,"listeners",{value:{},enumerable:!1,writable:!0}),Object.defineProperty(this,"oneTimeEvents",{value:{},enumerable:!1,writable:!0}),Object.defineProperty(this,"oneTimeArguments",{value:{},enumerable:!1,writable:!0}),this.context=e,this.utils=o.$get(e),this.log=i.$get(e)}return t.prototype.hasListeners=function(t){return t in this.listeners},t.prototype.registerOneTimeEvent=function(t){this.oneTimeEvents[t]=!1,this.oneTimeArguments[t]=[]},t.prototype.on=function(t,e){var n=this;if("string"==typeof t&&(t=[t]),!t)throw new Error("No events to subscribe to");if("function"!=typeof e)throw new Error("Callback must be a function");var r=this;return t.forEach(function(t){r.hasListeners(t)||(r.listeners[t]=[]),r.listeners[t].push(e),r.isOneTimeEventFired(t)&&(n.log.debug("Observable.on(%s): One-time event has been fired already, executing callback",t),e.apply(r,r.getOneTimeEventArgumens(t)))}),this},t.prototype.emit=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(this.isOneTimeEventFired(t))return this.log.debug("Observable.emit(%s): One-time event has been fired already",t),null;var o=null;return this.isOneTimeEvent(t)&&(this.setOneTimeEventFired(t),this.setOneTimeEventArgumens(t,n)),this.hasListeners(t)?(this.listeners[t].some(function(t){return o=t.apply(e,n),o===!1}),o):null},t.prototype.off=function(t,e){var n=this;if(e){if(!this.hasListeners(t))return this;this.listeners[t].forEach(function(r,o){r===e&&delete n.listeners[t][o]})}else delete this.listeners[t];return this},t.prototype.isOneTimeEvent=function(t){return t in this.oneTimeEvents},t.prototype.isOneTimeEventFired=function(t){return this.isOneTimeEvent(t)?this.oneTimeEvents[t]:!1},t.prototype.setOneTimeEventFired=function(t){this.oneTimeEvents[t]=!0},t.prototype.setOneTimeEventArgumens=function(t,e){this.oneTimeArguments[t]=e},t.prototype.getOneTimeEventArgumens=function(t){return this.oneTimeArguments[t]},t.prototype.offAll=function(){return this.listeners={},this.oneTimeEvents={},this.oneTimeArguments={},this},t.prototype.destroy=function(){return this.offAll(),this.log.debug("Observable.destroy(): Listeners were destroyed"),this},t.prototype.emitAndCallback=function(t,e,n){return e=this.utils.argumentsToArray(e),t&&this.emit.apply(this,[t].concat(e)),n&&n.apply(this,e),this},t}();e.Observable=s,e.$get=r},function(t,e,n){function r(t){return new s(t)}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(16),s=function(t){function e(e){var n=this;t.call(this,e),this.events={change:"change"};var r="hidden",o=function(t){t=t||window.event;var e="visible",o="hidden",i={focus:e,focusin:e,pageshow:e,blur:o,focusout:o,pagehide:o};n.visible=t.type in i?i[t.type]==e:!document[r],n.emit(n.events.change,n.visible)};this.visible=!0,"undefined"!=typeof document&&"undefined"!=typeof window&&(r in document?document.addEventListener("visibilitychange",o):(r="mozHidden")in document?document.addEventListener("mozvisibilitychange",o):(r="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",o):(r="msHidden")in document?document.addEventListener("msvisibilitychange",o):"onfocusin"in document?document.onfocusin=document.onfocusout=o:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=o)}return o(e,t),e.prototype.isVisible=function(){return this.visible},e}(i.Observable);e.PageVisibility=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Platform",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(16),s=n(11),u=n(45),a=function(t){function e(e){t.call(this,e),this.events={accessViolation:"accessViolation",logoutSuccess:"logoutSuccess",logoutError:"logoutError",authorizeSuccess:"authorizeSuccess",authorizeError:"authorizeError",refreshSuccess:"refreshSuccess",refreshError:"refreshError"},this.server="",this.apiKey="",this.account="~",this.urlPrefix="/restapi",this.apiVersion="v1.0",this.accountPrefix="/account/",this.accessTokenTtl=null,this.refreshTokenTtl=36e3,this.refreshTokenTtlRemember=604800,this.refreshHandicapMs=6e4,this.refreshDelayMs=100,this.clearCacheOnRefreshError=!0,this.refreshPromise=null,this.cacheId="platform",this.pollInterval=250,this.releaseTimeout=5e3}return o(e,t),e.prototype.getStorage=function(){return s.$get(this.context)},e.prototype.getRequest=function(){return u.$get(this.context)},e.prototype.clearStorage=function(){return this.getStorage().clean(),this},e.prototype.setCredentials=function(t,e){var n=(t||"")+":"+(e||"");return":"==n?this:(this.apiKey="function"==typeof btoa?btoa(n):new Buffer(n).toString("base64"),this)},e.prototype.setServer=function(t){return this.server=t||"",this},e.prototype.remember=function(t){var e=this.cacheId+"-remember";return void 0!==t?(this.getStorage().setItem(e,t),this):this.getStorage().getItem(e)||!1},e.prototype.authorize=function(t){var e=this;return t=t||{},t.remember=t.remember||!1,this.authCall({url:"/restapi/oauth/token",post:{grant_type:"password",username:t.username,extension:t.extension||"",password:t.password,access_token_ttl:this.accessTokenTtl,refresh_token_ttl:t.remember?this.refreshTokenTtlRemember:this.refreshTokenTtl}}).then(function(n){return e.setCache(n.data).remember(t.remember).emitAndCallback(e.events.authorizeSuccess,[]),n})["catch"](function(t){throw e.clearStorage().emitAndCallback(e.events.authorizeError,[t]),t})},e.prototype.isPaused=function(){var t=this.getStorage(),e=this.cacheId+"-refresh";return!!t.getItem(e)&&Date.now()-parseInt(t.getItem(e))<this.releaseTimeout},e.prototype.pause=function(){return this.getStorage().setItem(this.cacheId+"-refresh",Date.now()),this},e.prototype.resume=function(){return this.getStorage().removeItem(this.cacheId+"-refresh"),this},e.prototype.refresh=function(){var t=this,e=new(this.context.getPromise())(function(e,n){return t.isPaused()?e(t.refreshPolling(null)):(t.pause(),void setTimeout(function(){var r=t.getAuthData();return t.log.debug("Platform.refresh(): Performing token refresh (access token",r.access_token,", refresh token",r.refresh_token,")"),r&&r.refresh_token?Date.now()>r.refreshExpireTime?n(new Error("Refresh token has expired")):t.isPaused()?void e(t.authCall({url:"/restapi/oauth/token",post:{grant_type:"refresh_token",refresh_token:r.refresh_token,access_token_ttl:t.accessTokenTtl,refresh_token_ttl:t.remember()?t.refreshTokenTtlRemember:t.refreshTokenTtl}})):n(new Error("Queue was resumed before refresh call")):n(new Error("Refresh token is missing"))},t.refreshDelayMs))});return e.then(function(e){if(!e||!e.data)return e;if(t.log.info("Platform.refresh(): Token was refreshed"),!e.data.refresh_token||!e.data.access_token){var n=new Error("Malformed OAuth response");throw n.ajax=e,n}return t.setCache(e.data).resume(),e}).then(function(e){return t.emit(t.events.refreshSuccess,e),e})["catch"](function(e){throw t.clearCacheOnRefreshError&&t.clearStorage(),t.emitAndCallback(t.events.accessViolation,[e]).emitAndCallback(t.events.refreshError,[e]),e})},e.prototype.logout=function(){var t=this;return this.pause(),this.authCall({url:"/restapi/oauth/revoke",post:{token:this.getToken()}}).then(function(e){return t.resume().clearStorage().emit(t.events.logoutSuccess,e),e})["catch"](function(e){throw t.resume().emitAndCallback(t.events.accessViolation,[e]).emitAndCallback(t.events.logoutError,[e]),e})},e.prototype.refreshPolling=function(t){var e=this;return this.refreshPromise?this.refreshPromise:(this.refreshPromise=new(this.context.getPromise())(function(n,r){e.log.warn("Platform.refresh(): Refresh is already in progress polling started"),e.utils.poll(function(o){return e.isPaused()?o():(e.refreshPromise=null,e.resume(),void(e.isTokenValid()?n(t):r(new Error("Automatic authentification timeout"))))},e.pollInterval)}),this.refreshPromise)},e.prototype.getToken=function(){return this.getAuthData().access_token},e.prototype.getTokenType=function(){return this.getAuthData().token_type},e.prototype.getAuthData=function(){return this.getStorage().getItem(this.cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},e.prototype.isTokenValid=function(){var t=this.getAuthData();return t.token_type==e.forcedTokenType||new Date(t.expireTime).getTime()-this.refreshHandicapMs>Date.now()&&!this.isPaused()},e.prototype.isAuthorized=function(){return this.isTokenValid()?this.context.getPromise().resolve(!0):this.refresh()},e.prototype.cancelAccessToken=function(){return this.setCache(this.utils.extend(this.getAuthData(),{access_token:"",expires_in:0}))},e.prototype.setCache=function(t){var e=this.getAuthData();return this.log.info("Platform.setCache(): Tokens were updated, new:",t,", old:",e),t.expireTime=Date.now()+1e3*t.expires_in,t.refreshExpireTime=Date.now()+1e3*t.refresh_token_expires_in,this.getStorage().setItem(this.cacheId,t),this},e.prototype.forceAuthentication=function(){return this.setCache({token_type:e.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},e.prototype.apiCall=function(t){var e=this;return t=t||{},t.url=this.apiUrl(t.url,{addServer:!0}),this.isAuthorized().then(function(){var n=e.getToken();return e.getRequest().setOptions(t).setHeader("Authorization",e.getTokenType()+(n?" "+n:"")).send()})["catch"](function(n){if(!n.response||!n.response.isUnauthorized())throw n;return e.cancelAccessToken(),e.refresh().then(function(){return e.apiCall(t)})})},e.prototype.get=function(t,e){return e=e||{},e.url=t,e.method="GET",this.apiCall(e)},e.prototype.post=function(t,e){return e=e||{},e.url=t,e.method="POST",this.apiCall(e)},e.prototype.put=function(t,e){return e=e||{},e.url=t,e.method="PUT",this.apiCall(e)},e.prototype["delete"]=function(t,e){return e=e||{},e.url=t,e.method="DELETE",this.apiCall(e)},e.prototype.authCall=function(t){return t=t||{},t.method=t.method||"POST",t.url=this.apiUrl(t.url,{addServer:!0}),this.getRequest().setOptions(t).setHeader("Content-Type","application/x-www-form-urlencoded").setHeader("Accept","application/json").setHeader("Authorization","Basic "+this.apiKey).send()},e.prototype.apiUrl=function(t,e){t=t||"",e=e||{};var n="";return e.addServer&&-1==t.indexOf("http://")&&-1==t.indexOf("https://")&&(n+=this.server),-1==t.indexOf(this.urlPrefix)&&(n+=this.urlPrefix+"/"+this.apiVersion),t.indexOf(this.accountPrefix)>-1&&n.replace(this.accountPrefix+"~",this.accountPrefix+this.account),n+=t,(e.addMethod||e.addToken)&&(n+=t.indexOf("?")>-1?"&":"?"),e.addMethod&&(n+="_method="+e.addMethod),e.addToken&&(n+=(e.addMethod?"&":"")+"access_token="+this.getToken()),n},e.prototype.destroy=function(){return t.prototype.destroy.call(this),this},e.prototype.on=function(e,n){return t.prototype.on.call(this,e,n),this},e.prototype.off=function(e,n){return t.prototype.on.call(this,e,n),this},e.prototype.emitAndCallback=function(e,n,r){return t.prototype.emitAndCallback.call(this,e,n,r),this},e.forcedTokenType="forced",e}(i.Observable);e.Platform=a,e.$get=r},function(t,e,n){function r(t){return new s(t)}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(16),s=function(t){function e(e){t.call(this,e),this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},this.pubnub=null,this.eventFilters=[],this.timeout=null,this.subscription={eventFilters:[],expirationTime:"",expiresIn:0,deliveryMode:{transportType:"PubNub",encryption:!1,address:"",subscriberKey:"",secretKey:""},id:"",creationTime:"",status:"",uri:""}}return o(e,t),e.prototype.getPubnub=function(){return this.context.getPubnub()},e.prototype.getCrypto=function(){return this.context.getCryptoJS()},e.prototype.getPlatform=function(){return n(18).$get(this.context)},e.prototype.register=function(t){return this.isSubscribed()?this.renew(t):this.subscribe(t)},e.prototype.addEvents=function(t){return this.eventFilters=this.eventFilters.concat(t),this},e.prototype.setEvents=function(t){return this.eventFilters=t,this},e.prototype.getFullEventFilters=function(){var t=this;return this.eventFilters.map(function(e){return t.getPlatform().apiUrl(e)})},e.prototype.subscribe=function(t){var e=this;return t=t||{},t.events&&(this.eventFilters=t.events),this.clearTimeout(),new(this.context.getPromise())(function(t){if(!e.eventFilters||!e.eventFilters.length)throw new Error("Events are undefined");t(e.getPlatform().apiCall({method:"POST",url:"/restapi/v1.0/subscription",post:{eventFilters:e.getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}}))}).then(function(t){return e.updateSubscription(t.data).subscribeAtPubnub().emit(e.events.subscribeSuccess,t.data),t})["catch"](function(t){throw e.unsubscribe().emit(e.events.subscribeError,t),t})},e.prototype.renew=function(t){var e=this;return t=t||{},t.events&&(this.eventFilters=t.events),this.clearTimeout(),new(this.context.getPromise())(function(t){if(!e.subscription||!e.subscription.id)throw new Error("Subscription ID is required");if(!e.eventFilters||!e.eventFilters.length)throw new Error("Events are undefined");t()}).then(function(){return e.getPlatform().apiCall({method:"PUT",url:"/restapi/v1.0/subscription/"+e.subscription.id,post:{eventFilters:e.getFullEventFilters()}})}).then(function(t){return e.updateSubscription(t.data).emit(e.events.renewSuccess,t.data),t})["catch"](function(t){throw e.unsubscribe().emit(e.events.renewError,t),t})},e.prototype.remove=function(t){var e=this;return t=this.utils.extend({async:!0},t),new(this.context.getPromise())(function(n){if(!e.subscription||!e.subscription.id)throw new Error("Subscription ID is required");n(e.getPlatform().apiCall({async:!!t.async,method:"DELETE",url:"/restapi/v1.0/subscription/"+e.subscription.id}))}).then(function(t){return e.unsubscribe().emit(e.events.removeSuccess,t),t})["catch"](function(t){throw e.emit(e.events.removeError,t),t})},e.prototype.destroy=function(){return this.unsubscribe(),this.log.info("RC.core.Subscription: Destroyed"),t.prototype.destroy.call(this)},e.prototype.isSubscribed=function(){return this.subscription&&this.subscription.deliveryMode&&this.subscription.deliveryMode.subscriberKey&&this.subscription.deliveryMode.address},e.prototype.setTimeout=function(){var t=this,n=1e3*this.subscription.expiresIn-e.renewHandicapMs;this.timeout=setTimeout(function(){t.renew({})},n)},e.prototype.clearTimeout=function(){clearTimeout(this.timeout)},e.prototype.updateSubscription=function(t){return this.clearTimeout(),this.subscription=t,this.setTimeout(),this},e.prototype.unsubscribe=function(){return this.clearTimeout(),this.pubnub&&this.isSubscribed()&&this.pubnub.unsubscribe({channel:this.subscription.deliveryMode.address}),this.subscription=null,this},e.prototype.notify=function(t){if(this.isSubscribed()&&this.subscription.deliveryMode.encryptionKey){var e=this.getCrypto(),n=e.enc.Base64.parse(this.subscription.deliveryMode.encryptionKey),r=e.enc.Base64.parse(t),o=e.AES.decrypt({ciphertext:r},n,{mode:e.mode.ECB,padding:e.pad.Pkcs7}).toString(e.enc.Utf8);t=JSON.parse(o)}return this.emit(this.events.notification,t),this},e.prototype.subscribeAtPubnub=function(){var t=this;if(!this.isSubscribed())return this;var e=this.getPubnub();return this.pubnub=e.init({ssl:!0,subscribe_key:this.subscription.deliveryMode.subscriberKey}),this.pubnub.ready(),this.pubnub.subscribe({channel:this.subscription.deliveryMode.address,message:function(e){t.log.info("RC.core.Subscription: Incoming message",e),t.notify(e)},connect:function(){t.log.info("RC.core.Subscription: PUBNUB connected")}}),this},e.prototype.on=function(e,n){return t.prototype.on.call(this,e,n),this},e.prototype.off=function(e,n){return t.prototype.on.call(this,e,n),this},e.prototype.emitAndCallback=function(e,n,r){return t.prototype.emitAndCallback.call(this,e,n,r),this},e.renewHandicapMs=6e4,e}(i.Observable);e.Subscription=s,e.$get=r},function(t,e){function n(t){return t.createSingleton("Utils",function(){return new u})}var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=/\d/,s={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(t){s["[object "+t+"]"]=t.toLowerCase()});var u=function(){function t(){}return t.prototype.extend=function(){for(var t=[],e=2;e<arguments.length;e++)t[e-2]=arguments[e];var n,r,o,i,s,u,a=arguments[0]||{},c=1,p=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[c]||{},c++),"object"==typeof a||this.isFunction(a)||(a={});p>c;c++)if(null!==(n=arguments[c]))for(r in n)o=a[r],i=n[r],a!==i&&(h&&i&&(this.isPlainObject(i)||(s=this.isArray(i)))?(s?(s=!1,u=o&&this.isArray(o)?o:[]):u=o&&this.isPlainObject(o)?o:{},a[r]=this.extend(h,u,i)):void 0!==i&&(a[r]=i));return a},t.prototype.forEach=function(t,e){for(var n in t)if(t.hasOwnProperty(n)){var r=e(t[n],n);if(r===!1)break}},t.prototype.queryStringify=function(t){var e=this,n=[];return this.forEach(t,function(t,r){e.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(r)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(r)+"="+encodeURIComponent(t))}),n.join("&")},t.prototype.parseQueryString=function(t){var e={},n=this;return t.split("&").forEach(function(t){if(t=decodeURIComponent(t),-1==t.indexOf("="))e[t.trim()]=!0;else{var r=t.split("="),o=r[0].trim(),i=r[1].trim();o in e?(o in e&&!n.isArray(e[o])&&(e[o]=[e[o]]),e[o].push(i)):e[o]=i}}),e},t.prototype.isEmail=function(t,e){return e?/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?[ ,;]*)+$/i.test(t):/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(t)},t.prototype.isPhoneNumber=function(t){return/\+?1[0-9]{3}[0-9a-z]{7}/im.test(t.toString().split(/[^0-9a-z\+]/im).join(""))},t.prototype.argumentsToArray=function(t){return Array.prototype.slice.call(t||[],0)},t.prototype.isDate=function(t){return"date"===this.type(t)},t.prototype.isFunction=function(t){return"function"===this.type(t)},t.prototype.isArray=function(t){return Array.isArray?Array.isArray(t):"array"===this.type(t)},t.prototype.isWindow=function(t){return t&&"object"==typeof t&&"setInterval"in t},t.prototype.isNaN=function(t){return null===t||!i.test(t)||isNaN(t)},t.prototype.type=function(t){return null===t?String(t):s[o.call(t)]||"object"},t.prototype.isPlainObject=function(t){if(!t||"object"!==this.type(t)||t.nodeType||this.isWindow(t))return!1;if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||r.call(t,e)
},t.prototype.getProperty=function(t,e){return e.split(/[.[\]]/).reduce(function(t,e){return t?e?t[e]:t:void 0},t)},t.prototype.poll=function(t,e,n){this.stopPolling(n),e=e||1e3;var r=function(n){return n=n||e,e=n,setTimeout(function(){t(r,n)},n)};return r()},t.prototype.stopPolling=function(t){t&&clearTimeout(t)},t.prototype.parseString=function(t){return t?t.toString():""},t.prototype.parseNumber=function(t){return t?(t=parseFloat(t),isNaN(t)?0:t):0},t}();e.Utils=u,e.$get=n},function(t,e,n){function r(t){return t.createSingleton("Validator",function(){return new i(t)})}var o=n(20),i=function(){function t(t){this.context=t,this.utils=o.$get(t)}return t.prototype.validate=function(t){var e={errors:{},isValid:!0};return e.errors=t.reduce(function(t,n){var r=n.validator();return r.length>0&&(e.isValid=!1,t[n.field]=t[n.field]||[],t[n.field]=t[n.field].concat(r)),t},{}),e},t.prototype.email=function(t,e){var n=this;return function(){return t?n.utils.isEmail(t,e)?[]:[new Error("Value has to be a valid email")]:[]}},t.prototype.phone=function(t){var e=this;return function(){return t?e.utils.isPhoneNumber(t)?[]:[new Error("Value has to be a valid US phone number")]:[]}},t.prototype.required=function(t){return function(){return t?[]:[new Error("Field is required")]}},t.prototype.length=function(t,e,n){return function(){var r=[];return t?(t=t.toString(),n&&t.length<n&&r.push(new Error("Minimum length of "+n+" characters is required")),e&&t.length>e&&r.push(new Error("Maximum length of "+e+" characters is required")),r):r}},t}();e.Validator=i,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Account",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments)}return o(e,t),e.prototype.createUrl=function(){return"/account/~"},e}(i.Helper);e.Account=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("BlockedNumber",function(){return new u(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(21),u=function(t){function e(e){t.call(this,e),this.validator=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"/account/~/extension/"+(t.extensionId?t.extensionId:"~")+"/blocked-number"+(e?"/"+e:"")},e.prototype.validate=function(t){return this.validator.validate([{field:"phoneNumber",validator:this.validator.phone(t.phoneNumber)},{field:"phoneNumber",validator:this.validator.required(t.phoneNumber)},{field:"name",validator:this.validator.required(t.name)}])},e}(i.Helper);e.BlockedNumber=u,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Call",function(){return new c(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=n(37),a=n(25),c=function(t){function e(e){t.call(this,e),this.list=s.$get(e),this.contact=a.$get(e),this.presence=u.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"personal"in t||"extensionId"in t||(t.personal=!0),"/account/~/"+(t.personal||t.extensionId?"extension/"+(t.extensionId||"~")+"/":"")+(t.active?"active-calls":"call-log")+(e?"/"+e:"")},e.prototype.getSessionId=function(t){return t&&t.sessionId},e.prototype.isInProgress=function(t){return t&&"In Progress"==t.result},e.prototype.isAlive=function(t){return t&&"Alive"==t.availability},e.prototype.isInbound=function(t){return t&&"Inbound"==t.direction},e.prototype.isOutbound=function(t){return!this.isInbound(t)},e.prototype.isMissed=function(t){return t&&"Missed"==t.result},e.prototype.isFindMe=function(t){return t&&"FindMe"==t.action},e.prototype.getCallerInfo=function(t){return this.isInbound(t)?t.from:t.to},e.prototype.getAllCallerInfos=function(t){return[this.getCallerInfo(t)].concat(this.isInbound(t)?t.to:t.from)},e.prototype.formatDuration=function(t){function e(t){return 10>t?"0"+t:t}var n=parseInt(t.duration),r=Math.floor(n/3600),o=Math.floor(n%3600/60),i=Math.floor(n%60);return(r?r+":":"")+e(o)+":"+e(i)},e.prototype.filter=function(t){return t=this.utils.extend({alive:!0,direction:"",type:""},t),this.list.filter([{filterBy:"direction",condition:t.direction},{filterBy:"type",condition:t.type}])},e.prototype.comparator=function(t){return this.list.comparator(this.utils.extend({sortBy:"startTime"},t))},e.prototype.attachContacts=function(t,e,n){var r=this,o=e.reduce(function(t,e){return t.concat(r.getAllCallerInfos(e))},[]);this.contact.attachToCallerInfos(o,t,n)},e.prototype.checkMergeability=function(t,e,n){function r(t){return new Date(t).getTime()}return(!n.strict||t.action&&-1!=t.action.toLowerCase().indexOf("ringout"))&&"Outbound"==t.direction&&"Inbound"==e.direction&&(!e.startTime&&!t.startTime||Math.abs(r(e.startTime)-r(t.startTime))<(n.maxStartTimeDiscrepancy||5e3))&&e.from.phoneNumber==t.to.phoneNumber&&(e.to.phoneNumber==t.from.phoneNumber||e.to.name==t.from.name)},e.prototype.combineCalls=function(t,e,n){n=n||{};var r=[];return t.hasSubsequent=!0,n.merge?(t.duration=t.duration>e.duration?t.duration:e.duration,t.from=e.to,t.to=e.from,r.push(t)):(e.subsequent=!0,e.startTime=t.startTime,r.push(t),r.push(e)),r},e.prototype.processCalls=function(t,e){var n=[],r=[],o=this;return t.forEach(function(i){var s=!1;i.subsequent=!1,i.hasSubsequent=!1,t.some(function(t){return i===t?!1:(o.checkMergeability(i,t,e)&&(n=n.concat(o.combineCalls(i,t,e)),r.push(i),r.push(t),s=!0),s)})}),t.forEach(function(t){-1==r.indexOf(t)&&n.push(t)}),n},e.prototype.parsePresenceCalls=function(t){var e=this;return t.map(function(t){return{id:t.id,uri:"",sessionId:t.sessionId,from:{phoneNumber:t.from},to:{phoneNumber:t.to},direction:t.direction,startTime:"",duration:0,type:"",action:"",result:e.presence.isCallInProgress(t)?"In Progress":t.telephonyStatus,telephonyStatus:t.telephonyStatus}})},e.prototype.getSignature=function(t){function e(t){return(t||"").toString().replace(/[^0-9]/gi,"")}return t.direction+"|"+(t.from&&e(t.from.phoneNumber))+"|"+(t.to&&e(t.to.phoneNumber))},e.prototype.mergePresenceCalls=function(t,e){var n=new Date,r=this.parsePresenceCalls(e&&e.activeCalls||[]).map(function(t){return delete t.startTime,t});return t=this.merge(t||[],r,this.getSessionId,!0),t.forEach(function(t){t.startTime||(t.startTime=n.toISOString())}),t},e.prototype.mergeAll=function(t,e,n){var r=this.merge(t||[],e||[],this.getSessionId,!0);return this.merge(r,n||[],this.getSessionId,!0)},e}(i.Helper);e.Call=c,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Contact",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(21),u=n(14),a=function(t){function e(e){t.call(this,e),this.phoneFields=["homePhone","homePhone2","businessPhone","businessPhone2","mobilePhone","companyPhone","assistantPhone","carPhone","otherPhone","callbackPhone"],this.faxFields=["businessFax","otherFax"],this.addressFields=["homeAddress","businessAddress","otherAddress"],this.addressSubFields=["street","city","state","zip"],this.nameFields=["firstName","middleName","lastName","nickName"],this.otherFields=["company","jobTitle","webPage","notes"],this.emailFields=["email","email2","email3"],this.list=u.$get(e),this.validator=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){t=t||{};var n="/account/~/extension/"+(t.extensionId?t.extensionId:"~")+"/address-book";return t.sync?n+"-sync":n+(t.groupId?"/group/"+t.groupId+"/contact":"/contact")+(e?"/"+e:"")},e.prototype.getFieldValues=function(t,e,n){return e.reduce(function(e,r){return t&&t[r]&&(n?e[r]=t[r]:e.push(t[r])),e},n?{}:[])},e.prototype.getFullName=function(t){return this.getFieldValues(t,this.nameFields).join(" ")},e.prototype.getEmails=function(t,e){return this.getFieldValues(t,this.emailFields,e)},e.prototype.getPhones=function(t,e){return this.getFieldValues(t,this.phoneFields,e)},e.prototype.getFaxes=function(t,e){return this.getFieldValues(t,this.faxFields,e)},e.prototype.getAddresses=function(t,e){return this.getFieldValues(t,this.addressFields,e)},e.prototype.isAlive=function(t){return"Alive"==t.availability},e.prototype.match=function(t,e,n){var r=this;n=this.utils.extend({fields:[].concat(this.nameFields,this.emailFields,this.phoneFields,this.faxFields,this.otherFields),inAddresses:!0,transformFn:function(t){return t?t.toString().toLocaleLowerCase():""},strict:!1},n),e=n.transformFn(e,n);var o=null;if(!e)return o;var i=function(t){if(!o){var r=n.transformFn(t,n);if(r){var i=n.strict?r==e:r.indexOf(e)>-1;i&&(o=t)}}};return n.fields.forEach(function(e){i(t[e])}),n.inAddresses&&!o&&this.addressFields.forEach(function(e){t[e]&&!o&&r.addressSubFields.forEach(function(n){i(t[e][n])})}),o},e.prototype.matchAsPhone=function(t,e,n){return this.match(t,e,this.utils.extend({fields:[].concat(this.phoneFields,this.faxFields),inAddresses:!1,transformFn:function(t){return t?t.toString().replace(/[^\d\w]/gi,""):""},strict:!1},n))},e.prototype.attachToCallerInfos=function(t,e,n){var r=this,o=this.index(t,function(t){return t.phoneNumber},!0);this.utils.forEach(o,function(t,o){var i=null,s=null;e.some(function(t){return s=r.matchAsPhone(t,o,n),s&&(i=t),s}),i&&t.forEach(function(t){t.contact=i,t.contactPhone=s})})},e.prototype.comparator=function(t){var e=this;return this.list.comparator(this.utils.extend({extractFn:function(t){return e.getFullName(t)}},t))},e.prototype.filter=function(t){var e=this;return t=this.utils.extend({alive:!0,startsWith:"",phonesOnly:!1,faxesOnly:!1},t),this.list.filter([{condition:t.alive,filterFn:this.isAlive},{condition:t.startsWith,filterFn:function(t,n){return e.match(t,n.condition)}},{condition:t.phonesOnly,filterFn:function(t){return e.getPhones(t).length>0}},{condition:t.faxesOnly,filterFn:function(t){return e.getFaxes(t).length>0}}])},e.prototype.validate=function(t){return this.validator.validate([{field:"firstName",validator:this.validator.required(t.firstName)},{field:"lastName",validator:this.validator.required(t.lastName)},{field:"email",validator:this.validator.email(t.email)},{field:"email2",validator:this.validator.email(t.email2)},{field:"email3",validator:this.validator.email(t.email3)}])},e}(i.Helper);e.Contact=a,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("ContactGroup",function(){return new u(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(21),u=function(t){function e(e){t.call(this,e),this.validator=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return"/account/~/extension/~/address-book/group"+(e?"/"+e:"")},e.prototype.validate=function(t){return this.validator.validate([{field:"groupName",validator:this.validator.required(t&&t.groupName)}])},e}(i.Helper);e.ContactGroup=u,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Conferencing",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments)}return o(e,t),e.prototype.createUrl=function(){return"/account/~/extension/~/conferencing"},e}(i.Helper);e.Conferencing=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Country",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments)}return o(e,t),e.prototype.createUrl=function(){return"/dictionary/country"},e}(i.Helper);e.Country=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Device",function(){return new c(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(21),u=n(31),a=n(30),c=function(t){function e(e){t.call(this,e),this.validator=s.$get(e),this.extension=u.$get(e),this.deviceModel=a.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},t.order?"/account/~/order":"/account/~"+(t.extensionId?"/extension/"+t.extensionId:"")+"/device"+(e?"/"+e:"")},e.prototype.validate=function(t){return this.validator.validate([{field:"emergencyServiceAddress-street",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.street)},{field:"emergencyServiceAddress-city",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.city)},{field:"emergencyServiceAddress-state",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.state)},{field:"emergencyServiceAddress-country",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.country)},{field:"emergencyServiceAddress-zip",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.zip)},{field:"emergencyServiceAddress-customerName",validator:this.validator.required(t&&t.emergencyServiceAddress&&t.emergencyServiceAddress.customerName)},{field:"extension",validator:this.validator.required(this.extension.getId(t&&t.extension))},{field:"model",validator:this.validator.required(this.deviceModel.getId(t&&t.model))}])},e}(i.Helper);e.Device=c,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("DeviceModel",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments),this.devices=[{id:"-1",name:"Softphone"},{id:"0",name:"Existing device"},{id:"19",name:"Cisco SPA-525G2 Desk Phone",deviceClass:"Desk Phone"},{id:"23",name:"Polycom IP 321 Basic IP phone",deviceClass:"Desk Phone"},{id:"30",name:"Polycom IP 550 HD Manager IP phone",deviceClass:"Desk Phone"},{id:"37",name:"Polycom IP 6000 Conference Phone",deviceClass:"Conference Phone"},{id:"40",name:"Polycom IP 335 HD IP phone",deviceClass:"Desk Phone"},{id:"51",name:"Cisco SPA-303 Desk Phone",deviceClass:"Desk Phone"},{id:"16",name:"Cisco SPA-508G Desk Phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"1"}]},{id:"16",name:"Cisco SPA-508G Desk Phone with 2 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"2"}]},{id:"16",name:"Cisco SPA-508G Desk Phone",deviceClass:"Desk Phone"},{id:"19",name:"Cisco SPA-525G2 Desk Phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"1"}]},{id:"19",name:"Cisco SPA-525G2 Desk Phone with 2 Expansion Modules	Desk Phone",addons:[{id:"2",name:"Cisco Sidecar",count:"2"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 1 Expansion Module",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"1"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 2 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"2"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone with 3 Expansion Modules",deviceClass:"Desk Phone",addons:[{id:"1",name:"Plolycom Expansion",count:"3"}]},{id:"34",name:"Polycom IP 650 HD Executive IP phone",deviceClass:"Desk Phone"},{id:"52",name:"Cisco SPA-122 ATA",deviceClass:"Analog Adapter"},{id:"53",name:"Polycom VVX-500 Color Touchscreen",deviceClass:"Desk Phone"},{id:"54",name:"Polycom VVX-310 Gigabit Ethernet Phone",deviceClass:"Desk Phone"},{id:"55",name:"Polycom VVX-410 Color Gigabit Ethernet Phone",deviceClass:"Desk Phone"}]}return o(e,t),e.prototype.getId=function(t){return t?t.id+(t.addons&&t.addons[0]?"-"+t.addons[0].id+"-"+t.addons[0].count:""):null},e.prototype.cleanForSaving=function(t){return t?(delete t.name,delete t.deviceClass,t.addons&&t.addons.length>0?t.addons.forEach(function(e,n){delete t.addons[n].name}):delete t.addons,t):null},e}(i.Helper);e.DeviceModel=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Extension",function(){return new u(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=function(t){function e(e){t.call(this,e),this.type={department:"Department",user:"User",announcement:"Announcement",voicemail:"Voicemail"},this.list=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"/account/~"+(t.departmentId?"/department/"+t.departmentId+"/members":"/extension")+(e?"/"+e:"")},e.prototype.isUser=function(t){return t&&t.type==this.type.user},e.prototype.isDepartment=function(t){return t&&t.type==this.type.department},e.prototype.isAnnouncement=function(t){return t&&t.type==this.type.announcement},e.prototype.isVoicemail=function(t){return t&&t.type==this.type.voicemail},e.prototype.comparator=function(t){return this.list.comparator(this.utils.extend({sortBy:"extensionNumber",compareFn:this.list.numberComparator},t))},e.prototype.filter=function(t){return t=this.utils.extend({search:"",type:""},t),this.list.filter([{filterBy:"type",condition:t.type},{condition:t.search.toLocaleLowerCase(),filterFn:this.list.containsFilter,extractFn:function(t){return(t.name&&t.name.toLocaleLowerCase()+" ")+(t.extensionNumber&&t.extensionNumber.toString().toLocaleLowerCase())}}])},e}(i.Helper);e.Extension=u,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("ForwardingNumber",function(){return new u(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=function(t){function e(e){t.call(this,e),this.list=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"/account/~/extension/"+(t.extensionId||"~")+"/forwarding-number"+(e?"/"+e:"")},e.prototype.getId=function(t){return t&&(t.id||t.phoneNumber)},e.prototype.hasFeature=function(t,e){return!!t&&!!t.features&&-1!=t.features.indexOf(e)},e.prototype.comparator=function(t){return this.list.comparator(this.utils.extend({sortBy:"label"},t))},e.prototype.filter=function(t){var e=this;return t=this.utils.extend({features:[]},t),this.list.filter([{condition:t.features.length,filterFn:function(n){return t.features.some(function(t){return e.hasFeature(n,t)})}}])},e}(i.Helper);e.ForwardingNumber=u,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Language",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments),this.languages=[{id:"1033",name:"English (US)"},{id:"3084",name:"French (Canada)"}]}return o(e,t),e}(i.Helper);e.Language=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Location",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=n(41),a=function(t){function e(e){t.call(this,e),this.list=s.$get(e),this.state=u.$get(e)}return o(e,t),e.prototype.createUrl=function(){return"/dictionary/location"},e.prototype.filter=function(t){var e=[];return t=this.utils.extend({stateId:"",onlyUniqueNPA:!1},t),this.list.filter([{condition:t.stateId,filterFn:function(t,e){return this.state.getId(t.state)==e.condition}.bind(this)},{condition:t.onlyUniqueNPA,filterFn:function(t){return-1==e.indexOf(t.npa)?(e.push(t.npa),!0):!1}}])},e.prototype.comparator=function(t){return t=this.utils.extend({sortBy:"npa"},t),"nxx"==t.sortBy&&(t.extractFn=function(t){return 1e6*parseInt(t.npa)+parseInt(t.nxx)},t.compareFn=this.list.numberComparator),this.list.comparator(t)},e}(i.Helper);e.Location=a,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Message",function(){return new h(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=n(21),a=n(19),c=n(18),p=n(25),h=function(t){function e(e){t.call(this,e),this.contact=p.$get(e),this.list=s.$get(e),this.platform=c.$get(e),this.validator=u.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){t=t||{};var n="/account/~/extension/"+(t.extensionId||"~");return t.fax?n+"/fax":t.sms?n+"/sms":t.pager?n+"/company-pager":t.sync?n+"/message-sync":n+"/message-store"+(e?"/"+e:"")},e.prototype.isInbound=function(t){return t&&"Inbound"==t.direction},e.prototype.isOutbound=function(t){return!this.isInbound(t)},e.prototype.isSMS=function(t){return t&&"SMS"==t.type},e.prototype.isPager=function(t){return t&&"Pager"==t.type},e.prototype.isVoiceMail=function(t){return t&&"VoiceMail"==t.type},e.prototype.isFax=function(t){return t&&"Fax"==t.type},e.prototype.isAlive=function(t){return t&&"Alive"==t.availability},e.prototype.isRead=function(t){return"Read"==t.readStatus},e.prototype.setIsRead=function(t,e){return t.readStatus=e?"Read":"Unread",t},e.prototype.getAttachmentUrl=function(t,e){return t.attachments[e]?this.platform.apiUrl(t.attachments[e].uri,{addMethod:"GET",addServer:!0,addToken:!0}):""},e.prototype.getAttachmentContentType=function(t,e){return t.attachments[e]?t.attachments[e].contentType:""},e.prototype.getSubscription=function(t){return a.$get(this.context).setEvents([this.createUrl(t)])},e.prototype.getCallerInfos=function(t){return this.isInbound(t)?[t.from]:t.to},e.prototype.getAllCallerInfos=function(t){return this.getCallerInfos(t).concat(this.isInbound(t)?t.to:[t.from])},e.prototype.comparator=function(t){return this.list.comparator(this.utils.extend({sortBy:"creationTime"},t))},e.prototype.filter=function(t){return t=this.utils.extend({search:"",alive:!0,direction:"",conversationId:"",readStatus:""},t),this.list.filter([{condition:t.alive,filterFn:this.isAlive},{filterBy:"type",condition:t.type},{filterBy:"direction",condition:t.direction},{filterBy:"conversationId",condition:t.conversationId},{filterBy:"readStatus",condition:t.readStatus},{filterBy:"subject",condition:t.search,filterFn:this.list.containsFilter}])},e.prototype.attachContacts=function(t,e,n){var r=this,o=e.reduce(function(t,e){return t.concat(r.getAllCallerInfos(e))},[]);this.contact.attachToCallerInfos(o,t,n)},e.prototype.shorten=function(t){return{from:t.from,to:t.to,text:t.subject}},e.prototype.validateSMS=function(t){return this.validator.validate([{field:"to",validator:this.validator.required(this.utils.getProperty(t,"to[0].phoneNumber"))},{field:"from",validator:this.validator.required(this.utils.getProperty(t,"from.phoneNumber"))},{field:"subject",validator:this.validator.required(this.utils.getProperty(t,"subject"))},{field:"subject",validator:this.validator.length(this.utils.getProperty(t,"subject"),160)}])},e.prototype.validatePager=function(t){return this.validator.validate([{field:"to",validator:this.validator.required(this.utils.getProperty(t,"to.extensionNumber"))},{field:"from",validator:this.validator.required(this.utils.getProperty(t,"from.extensionNumber"))},{field:"subject",validator:this.validator.required(this.utils.getProperty(t,"subject"))},{field:"subject",validator:this.validator.length(this.utils.getProperty(t,"subject"),160)}])},e}(i.Helper);e.Message=h,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("PhoneNumber",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=n(31),a=function(t){function e(e){t.call(this,e),this.extension=u.$get(e),this.list=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},t.lookup?"/number-pool/lookup":"/account/~"+(t.extensionId?"/extension/"+t.extensionId:"")+"/phone-number"+(e?"/"+e:"")},e.prototype.isSMS=function(t){return this.hasFeature(t,"SmsSender")},e.prototype.hasFeature=function(t,e){return!!t.features&&-1!=t.features.indexOf(e)},e.prototype.reserve=function(t,e){t.reservedTill=new Date(e).toISOString()},e.prototype.unreserve=function(t){t.reservedTill=null},e.prototype.comparator=function(t){return this.list.comparator(this.utils.extend({extractFn:function(t){return t.usageType+"-"+t.paymentType+"-"+t.type}},t))},e.prototype.filter=function(t){var e=this;return t=this.utils.extend({usageType:"",paymentType:"",type:"",features:[]},t),this.list.filter([{filterBy:"usageType",condition:t.usageType},{filterBy:"paymentType",condition:t.paymentType},{filterBy:"type",condition:t.type},{condition:t.features.length,filterFn:function(n){return t.features.some(function(t){return e.hasFeature(n,t)})}}])},e}(i.Helper);e.PhoneNumber=a,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Presence",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(19),u=n(31),a=function(t){function e(e){t.call(this,e),this.extension=u.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"/account/~/extension/"+(e||"~")+"/presence"+(t.detailed?"?detailedTelephonyState=true":"")},e.prototype.getId=function(t){return t&&(this.extension.getId(t.extension)||t.extensionId)},e.prototype.isAvailable=function(t){return t&&"Available"==t.presenceStatus},e.prototype.getSubscription=function(t,e){return s.$get(this.context).setEvents([this.createUrl(t,e)])},e.prototype.updateSubscription=function(t,e,n){var r=e.map(this.getId,this).map(function(t){return this.createUrl(n,t)},this);return t.addEvents(r),t},e.prototype.attachToExtensions=function(t,e,n){var r=this,o=this.index(e);return t.forEach(function(t){var e=o[r.extension.getId(t)];e&&("presence"in t&&n?r.utils.extend(t.presence,e):t.presence=e)},this),this},e.prototype.isCallInProgress=function(t){return t&&"NoCall"!=t.telephonyStatus},e}(i.Helper);e.Presence=a,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Ringout",function(){return new u(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(21),u=function(t){function e(e){t.call(this,e),this.validator=s.$get(e)}return o(e,t),e.prototype.createUrl=function(t,e){return t=t||{},"/account/~/extension/"+(t.extensionId||"~")+"/ringout"+(e?"/"+e:"")},e.prototype.resetAsNew=function(e){return e=t.prototype.resetAsNew.call(this,e),e&&delete e.status,e},e.prototype.isInProgress=function(t){return t&&!this.isNew(t)&&t.status&&"InProgress"==t.status.callStatus},e.prototype.isSuccess=function(t){return t&&!this.isNew(t)&&t.status&&"Success"==t.status.callStatus},e.prototype.isError=function(t){return!this.isNew(t)&&!this.isInProgress(t)&&!this.isSuccess(t)},e.prototype.validate=function(t){return this.validator.validate([{field:"to",validator:this.validator.required(t&&t.to&&t.to.phoneNumber)},{field:"from",validator:this.validator.required(t&&t.from&&t.from.phoneNumber)}])},e}(i.Helper);e.Ringout=u,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Service",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments),this.isSmsEnabled=this.isServiceFeatureEnabledMethod("SMS"),this.isSmsReceivingEnabled=this.isServiceFeatureEnabledMethod("SMSReceiving"),this.isPresenceEnabled=this.isServiceFeatureEnabledMethod("Presence"),this.isRingOutEnabled=this.isServiceFeatureEnabledMethod("RingOut"),this.isInternationalCallingEnabled=this.isServiceFeatureEnabledMethod("InternationalCalling"),this.isDndEnabled=this.isServiceFeatureEnabledMethod("DND"),this.isFaxEnabled=this.isServiceFeatureEnabledMethod("Fax"),this.isFaxReceivingEnabled=this.isServiceFeatureEnabledMethod("FaxReceiving"),this.isVoicemailEnabled=this.isServiceFeatureEnabledMethod("Voicemail"),this.isPagerEnabled=this.isServiceFeatureEnabledMethod("Pager"),this.isPagerReceivingEnabled=this.isServiceFeatureEnabledMethod("PagerReceiving"),this.isVoipCallingEnabled=this.isServiceFeatureEnabledMethod("VoipCalling"),this.isVideoConferencingEnabled=this.isServiceFeatureEnabledMethod("VideoConferencing"),this.isSalesForceEnabled=this.isServiceFeatureEnabledMethod("SalesForce"),this.isIntercomEnabled=this.isServiceFeatureEnabledMethod("Intercom"),this.isPagingEnabled=this.isServiceFeatureEnabledMethod("Paging"),this.isConferencingEnabled=this.isServiceFeatureEnabledMethod("Conferencing"),this.isFreeSoftPhoneLinesEnabled=this.isServiceFeatureEnabledMethod("FreeSoftPhoneLines"),this.isHipaaComplianceEnabled=this.isServiceFeatureEnabledMethod("HipaaCompliance"),this.isCallParkEnabled=this.isServiceFeatureEnabledMethod("CallPark"),this.isOnDemandCallRecordingEnabled=this.isServiceFeatureEnabledMethod("OnDemandCallRecording")}return o(e,t),e.prototype.createUrl=function(){return"/account/~/service-info"},e.prototype.isEnabled=function(t,e){return e.reduce(function(e,n){return n.featureName==t&&(e=n.enabled),e},!1)},e.prototype.isServiceFeatureEnabledMethod=function(t){return function(e){return this.isEnabled(t,e)}},e}(i.Helper);e.Service=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("ShippingMethod",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments),this.shippingMethods=[{id:"1",name:"Ground Shipping (5-7 business days)"},{id:"2",name:"2-days Shipping"},{id:"3",name:"Overnight Shipping"}]}return o(e,t),e}(i.Helper);e.ShippingMethod=s,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("State",function(){return new a(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=n(14),u=n(28),a=function(t){function e(e){t.call(this,e),this.countryHelper=u.$get(e),this.list=s.$get(e)}return o(e,t),e.prototype.createUrl=function(){return"/dictionary/state"},e.prototype.filter=function(t){var e=this;return t=this.utils.extend({countryId:""},t),this.list.filter([{condition:t.countryId,filterFn:function(t,n){return e.countryHelper.getId(t.country)==n.condition}}])},e}(i.Helper);e.State=a,e.$get=r},function(t,e,n){function r(t){return t.createSingleton("Timezone",function(){return new s(t)})}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(13),s=function(t){function e(){t.apply(this,arguments)}return o(e,t),e.prototype.createUrl=function(){return"/dictionary/timezone"},e}(i.Helper);e.Timezone=s,e.$get=r},function(t,e){function n(t){return new o(t)}var r=function(){function t(){}return t.prototype.ready=function(){},t.prototype.unsubscribe=function(){},t.prototype.subscribe=function(t){this.onMessage=t.message},t.prototype.receiveMessage=function(t){this.onMessage(t,"env","channel")},t}();e.PubnubMock=r;var o=function(){function t(t){this.context=t}return t.prototype.init=function(){return new r},t}();e.PubnubFactory=o,e.$get=n},function(t,e,n){function r(t){return new u(t)}var o=n(20),i=n(15),s=n(9),u=function(){function t(t){this.context=t,this.responses=s.$get(t),this.log=i.$get(t),this.utils=o.$get(t),this.async=!0,this.method="",this.url="",this.requestHeaders={},this.withCredentials=!1,this.data=null,this.readyState=0,this.responseHeaders={},this.status=0
}return t.prototype.getResponseHeader=function(t){return this.responseHeaders[t.toLowerCase()]},t.prototype.setRequestHeader=function(t,e){this.requestHeaders[t.toLowerCase()]=e},t.prototype.getAllResponseHeaders=function(){var t=[];return this.utils.forEach(this.responseHeaders,function(e,n){t.push(n+":"+e)}),t.join("\n")},t.prototype.open=function(t,e,n){this.method=t,this.url=e,this.async=n},t.prototype.send=function(t){var e=this,n=this.getRequestHeader("Content-Type");this.data=t,this.data&&"string"==typeof this.data&&("application/json"==n&&(this.data=JSON.parse(this.data)),"application/x-www-form-urlencoded"==n&&(this.data=this.utils.parseQueryString(this.data))),this.log.debug("API REQUEST",this.method,this.url);var r=this.responses.find(this);if(!r)return void setTimeout(function(){e.onerror&&e.onerror(new Error("Unknown request: "+e.url))},1);this.setStatus(200),this.setResponseHeader("Content-Type","application/json");var o=r.response(this),i=this.context.getPromise(),s=function(t){"application/json"==e.getResponseHeader("Content-Type")&&(t=JSON.stringify(t)),e.responseText=t,setTimeout(function(){e.onload&&e.onload()},1)};o instanceof i?o.then(s.bind(this))["catch"](this.onerror.bind(this)):s(o)},t.prototype.abort=function(){this.log.debug("XhrMock.destroy(): Aborted")},t.prototype.getRequestHeader=function(t){return this.requestHeaders[t.toLowerCase()]},t.prototype.setResponseHeader=function(t,e){this.responseHeaders[t.toLowerCase()]=e},t.prototype.setStatus=function(t){return this.status=t,this},t}();e.XhrMock=u,e.$get=r},function(t,e,n){function r(t){return new a(t)}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(46),s=n(10),u=n(47),a=function(t){function e(e){t.call(this,e),this.async=!0,this.method="",this.url="",this.query=null,this.body={},this.context=e,this.xhr=null,this.observer=s.$get(e)}return o(e,t),e.prototype.isLoaded=function(){return!!this.xhr},e.prototype.setHeader=function(e,n){return t.prototype.setHeader.call(this,e,n),this},e.prototype.setHeaders=function(e){return t.prototype.setHeaders.call(this,e),this},e.prototype.setOptions=function(t){return t=t||{},"body"in t||!t.post||(t.body=t.post),"query"in t||!t.get||(t.query=t.get),"method"in t&&(this.method=t.method),"url"in t&&(this.url=t.url),"query"in t&&(this.query=t.query),"body"in t&&(this.body=t.body),"headers"in t&&this.setHeaders(t.headers),"async"in t&&(this.async=!!t.async),this},e.prototype.checkOptions=function(){if(!this.url)throw new Error("Url is not defined");if(this.hasHeader("Accept")||this.setHeader("Accept",i.Headers.jsonContentType),this.hasHeader("Content-Type")||this.setHeader("Content-Type",i.Headers.jsonContentType),this.method=this.method?this.method.toUpperCase():"GET",["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"].indexOf(this.method)<0)throw new Error("Method has wrong value");return this},e.prototype.getEncodedBody=function(){return"GET"===this.method?null:"string"==typeof this.body?this.body:this.isJson()?JSON.stringify(this.body):this.isUrlEncoded()?this.utils.queryStringify(this.body):this.body},e.prototype.send=function(){var t=this;this.observer.emit(this.observer.events.beforeRequest,this);var e=new(this.context.getPromise())(function(e,n){t.checkOptions();var r=t.getXHR(),o=t.url+(t.query?(t.url.indexOf("?")>-1?"&":"?")+t.utils.queryStringify(t.query):"");r.open(t.method,o,t.async),r.withCredentials=!0,r.onload=function(){var o=u.$get(t.context,r.status,r.statusText,r.responseText,r.getAllResponseHeaders());if(o.error){var i=o.error;i.ajax=o,i.response=o,i.request=t,n(i)}else e(o)},r.onerror=function(e){var r=new Error("The request cannot be sent"+(e?" ("+e.toString()+")":""));r.request=t,r.response=null,r.ajax=null,n(r)},t.utils.forEach(t.headers,function(t,e){t&&r.setRequestHeader(e,t)}),r.send(t.getEncodedBody()),t.xhr=r});return e.then(function(e){return t.observer.emit(t.observer.events.requestSuccess,e,t),e})["catch"](function(e){throw t.observer.emit(t.observer.events.requestError,e),e})},e.prototype.getXHR=function(){return this.context.getXHR()},e.prototype.destroy=function(){this.xhr&&this.xhr.abort()},e}(i.Headers);e.Request=a,e.$get=r},function(t,e,n){var r=n(20),o=function(){function t(t){this.headers={},this.context=t,this.utils=r.$get(t)}return t.prototype.setHeader=function(t,e){return this.headers[t.toLowerCase()]=e,this},t.prototype.getHeader=function(t){return this.headers[t.toLowerCase()]},t.prototype.hasHeader=function(t){return t.toLowerCase()in this.headers},t.prototype.setHeaders=function(t){var e=this;return this.utils.forEach(t,function(t,n){e.setHeader(n,t)}),this},t.prototype.isContentType=function(t){return this.getContentType().indexOf(t)>-1},t.prototype.getContentType=function(){return this.getHeader(t.contentType)||""},t.prototype.isMultipart=function(){return this.isContentType(t.multipartContentType)},t.prototype.isUrlEncoded=function(){return this.isContentType(t.urlencodedContentType)},t.prototype.isJson=function(){return this.isContentType(t.jsonContentType)},t.contentType="Content-Type",t.jsonContentType="application/json",t.multipartContentType="multipart/mixed",t.urlencodedContentType="application/x-www-form-urlencoded",t}();e.Headers=o},function(t,e,n){function r(t,e,n,r,o){return new u(t,e,n,r,o)}var o=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},i=n(46),s=n(15),u=function(t){function e(n,r,o,u,a){var c=this;if(t.call(this,n),this.log=s.$get(n),"string"==typeof u&&(u=u.replace(/\r/g,""),!a)){var p=u.split(e.bodySeparator);a=p.length>1?p.shift():{},u=p.join(e.bodySeparator)}this.data=null,this.json=null,this.responses=[],this.error=null,1223==r&&(r=204),this.status=r,this.statusText=o,this.body=u;try{if("string"==typeof a?(a||"").split("\n").forEach(function(t){if(t){var n=t.split(e.headerSeparator),r=n.shift().trim();c.setHeader(r,n.join(e.headerSeparator).trim())}}):this.setHeaders(a),this.hasHeader(i.Headers.contentType)||this.setHeader(i.Headers.contentType,i.Headers.jsonContentType),this.isJson()&&this.body&&"string"==typeof this.body)this.json=JSON.parse(this.body),this.data=this.json,this.checkStatus()||(this.error=new Error(this.getError()));else if(this.isMultipart()){var h=this.getContentType().match(/boundary=([^;]+)/i)[1],l=this.body.split(e.boundarySeparator+h);""===l[0].trim()&&l.shift(),l[l.length-1].trim()==e.boundarySeparator&&l.pop();var f=new e(this.context,this.status,"",l.shift());this.responses=l.map(function(t,n){var r=f.data.response[n].status;return new e(c.context,r,"",t)}),this.data=this.responses}else this.data=this.body}catch(d){this.log.error("Response.parseResponse(): Unable to parse data"),this.log.error(d.stack||d),this.log.error(this.body),this.error=d}}return o(e,t),e.prototype.isUnauthorized=function(){return 401==this.status},e.prototype.checkStatus=function(){return this.status>=200&&this.status<300},e.prototype.getError=function(){return this.data.message||this.data.error_description||this.data.description||"Unknown error"},e.boundarySeparator="--",e.headerSeparator=":",e.bodySeparator="\n\n",e}(i.Headers);e.Response=u,e.$get=r}])});
//# sourceMappingURL=rc-sdk.min.js.map